if (self.CavalryLogger) { CavalryLogger.start_js(["bngKk"]); }

__d("SphericalPhotoConstants",[],(function a(b,c,d,e,f,g){f.exports={QE_ALL_UNIVERSE:"spherical_photo",QE_WWW_UNIVERSE:"spherical_photo_www_universe",QE_WWW_COMPOSER_UNIVERSE:"spherical_photo_www_composer_universe",FEED_TRACKING_KEY:"spherical_photo_interaction"};}),null);
__d('SphericalMediaCoreActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';var h={turnOn:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').TURN_ON};},turnOff:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').TURN_OFF};},enableSpherical:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').ENABLE_SPHERICAL};},disableSpherical:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').DISABLE_SPHERICAL};}};f.exports=h;}),null);
__d('SphericalMediaViewActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';f.exports={updateView:function h(i){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEW,data:i};},updateViewport:function h(i,j){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEWPORT,data:{yaw:i,pitch:j}};},updateFOV:function h(i){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_FOV,data:{fov:i}};},updateViewportAndFOV:function h(i,j,k){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEWPORT_AND_FOV,data:{yaw:i,pitch:j,fov:k}};},startAnimating:function h(){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').START_ANIMATING};},stopAnimating:function h(){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').STOP_ANIMATING};}};}),null);
__d('SphericalMediaController.react',['cx','Event','React','SphericalViewportControl','SubscriptionsHandler','debounce','getElementRect','performanceNow','throttle','SphericalMediaConstants'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('SphericalMediaConstants').GYRO_SLIP_FACTOR,l=c('SphericalMediaConstants').LOGGER_SIGNIFICANT_MOVEMENT_DEGREE,m=c('SphericalMediaConstants').LOGGER_SIGNIFICANT_MOVEMENT_MS,n=c('SphericalMediaConstants').RB_FRICTION,o=c('SphericalMediaConstants').RB_SPRING_FACTOR,p=c('SphericalMediaConstants').RB_MAX_SPRING_DEGREE,q=c('SphericalMediaConstants').RB_MAX_STRETCH_X_DEGREE,r=c('SphericalMediaConstants').RB_MAX_STRETCH_Y_DEGREE,s=c('SphericalMediaConstants').TILED_CUBE_TILE_CONTENT_SIZE;i=babelHelpers.inherits(t,c('React').Component);j=i&&i.prototype;function t(u){j.constructor.call(this,u);this.$SphericalMediaController3=0;this.$SphericalMediaController5=false;this.onViewChange=function(){var v=this.__sphericalViewportControl;if(v&&!v.isUpdating()){var w=this.__getViewData(),x=v.getOrientation(),y=v.getVerticalFieldOfView(),z=w.fov!==y||w.pitch!==x.y||w.yaw!==x.x;if(z){v.updateViewport(w.yaw,w.pitch,w.fov);this.$SphericalMediaController4=babelHelpers['extends']({},w);}}}.bind(this);this.$SphericalMediaController6=function(){if(!this.__viewport)return;var v=c('getElementRect')(this.__viewport);if(v.left!==0||v.right!==0||v.top!==0||v.bottom!==0||v.height!==0||v.width!==0)this.$SphericalMediaController1={x:v.left,y:v.top};}.bind(this);this.$SphericalMediaController2=new (c('SubscriptionsHandler'))();this.$SphericalMediaController2.addSubscriptions(c('Event').listen(window,'resize',c('debounce')(this.$SphericalMediaController6)));}t.prototype.componentWillReceiveProps=function(u){if(u.isActive!==this.props.isActive&&!u.isActive)this.$SphericalMediaController7();if(u.isActive)if(u.width!==this.props.width||u.height!==this.props.height)this.$SphericalMediaController8(u.width,u.height);};t.prototype.componentDidMount=function(){this.props.isActive&&this.$SphericalMediaController9();};t.prototype.shouldComponentUpdate=function(u){var v=u.isActive&&!this.__sphericalViewportControl||u.width!==this.props.width||u.height!==this.props.height;return v;};t.prototype.componentDidUpdate=function(){if(this.props.isActive&&!this.__sphericalViewportControl)this.$SphericalMediaController9();this.$SphericalMediaController6();};t.prototype.componentWillUnmount=function(){this.$SphericalMediaController7();};t.prototype.$SphericalMediaController9=function(){var u=void 0;if(!this.__viewport)return;u=this.__viewport;var v=this.__getSphericalConfig(this.props),w=new (c('SphericalViewportControl'))(u,v,this.$SphericalMediaController10(),this.props.showNewPhotoRenderer);this.$SphericalMediaController4={fov:v.fieldOfView,pitch:v.initialPitch,yaw:v.initialHeading};this.$SphericalMediaController6();w.addListener('updateViewportBegin',this.__onUpdateViewportBegin);w.addListener('updateViewportMoveStart',this.__onUpdateViewportMoveStart);w.addListener('DOM/click',this.__onDOMClick);w.addListener('updateViewportEnd',function(x,y){this.__onUpdateViewportEnd();this.$SphericalMediaController11();}.bind(this));w.addListener('initialViewportChange',this.__onInitialViewportChange);w.addListener('viewportChange',this.__onViewportChange);w.addListener('zoomStart',this.__onZoomStart);w.addListener('mouseEnter',this.__onMouseEnter);w.addListener('mouseMove',c('throttle')(this.__onMouseMove));if(this.props.showNewPhotoRenderer&&this.props.initialFov>179)w.setInitialOrientation();this.__sphericalViewportControl=w;this.$SphericalMediaController8(this.props.width,this.props.height);};t.prototype.$SphericalMediaController7=function(){this.$SphericalMediaController2.release();this.__sphericalViewportControl&&this.__sphericalViewportControl.destroy();this.__sphericalViewportControl=null;this.$SphericalMediaController5=true;};t.prototype.$SphericalMediaController11=function(){var u=c('performanceNow')();if(Math.abs(u-this.$SphericalMediaController3)<m)return;var v=this.$SphericalMediaController4;if(!v)return;var w=this.__getViewData(),x=w.yaw-v.yaw,y=w.pitch-v.pitch,z=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));if(l<z){this.__onSignificantMove(w);this.$SphericalMediaController3=u;this.$SphericalMediaController4=babelHelpers['extends']({},w);}};t.prototype.$SphericalMediaController8=function(u,v,w){var x=this.__sphericalViewportControl;if(x){x.updateViewportClientSize({width:u,height:v});if(this.props.maxTileLevel>0){var y=Math.pow(2,this.props.maxTileLevel),z=s*y/90,aa=v/z/3;x.updateMinVFOV(aa);}var ba=this.__getViewData();x.setFieldOfView(ba.fov);var ca=x.getVerticalFieldOfView();if(ca!==ba.fov)this.__updateFOV(ca);}};t.prototype.$SphericalMediaController10=function(){return {disableAutoClientSizeUpdate:true,enableGyro:this.props.enableGyro,enableRubberBanding:this.props.enableRubberBanding,maxSpringDegrees:p,maxStretchXDegrees:q,maxStretchYDegrees:r,minVFOV:this.props.maxTileLevel,rubberBandConstant:n,slipFactor:k,springFactor:o};};t.prototype.__getSphericalConfig=function(u){var v=this.__getPartialLimits(u),w=u.initialYaw,x=u.initialPitch,y=u.initialFov;if(this.$SphericalMediaController5){var z=this.__getViewData();y=z.fov;x=z.pitch;w=z.yaw;}return {initialHeading:w,initialPitch:x,fieldOfView:y,keyboardVelocityFactor:u.keyboardVelocityFactor,panningVelocityFactor:u.panningVelocityFactor,enableZoom:u.enableZoom,partialLimits:v||undefined};};t.prototype.__getPartialLimits=function(u){if(u.partialLeftDegrees||u.partialRightDegrees||u.partialTopDegrees||u.partialBottomDegrees)return {partialLeftDegrees:u.partialLeftDegrees,partialRightDegrees:u.partialRightDegrees,partialTopDegrees:u.partialTopDegrees,partialBottomDegrees:u.partialBottomDegrees};return null;};t.prototype.__getViewportMousePosition=function(u){if(!this.$SphericalMediaController1){this.$SphericalMediaController6();if(!this.$SphericalMediaController1)return null;}return {x:(u.clientX||u.changedTouches[0].clientX)-this.$SphericalMediaController1.x,y:(u.clientY||u.changedTouches[0].clientY)-this.$SphericalMediaController1.y};};t.prototype.__changeCursorStyle=function(u){if(!this.__viewport)return;this.__viewport.style.cursor=u;};t.prototype.render=function(){return c('React').createElement('div',{ref:function(u){return this.__viewport=u;}.bind(this),className:"_5nxw"+(' '+"_25i_")+(!this.props.isActive?' '+"hidden_elem":''),tabIndex:0,'aria-label':this.props.caption});};f.exports=t;}),null);
__d('SphericalMediaRenderer.react',['cx','DOM','BackgroundImage.react','React','SphericalPhotoConfig'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(l){j.constructor.call(this,l);this.$SphericalMediaRenderer2=false;this.$SphericalMediaRenderer3=false;if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var m in this.constructor.__subClassMethods)if(typeof this[m]!=='function')throw new Error('Must implement "'+m+'"');}k.prototype.componentWillReceiveProps=function(l){if(!l.isActive&&this.sphericalRenderer){this.__destroy();return;}};k.prototype.shouldComponentUpdate=function(l){return this.shouldRender;};k.prototype.componentDidMount=function(){this.$SphericalMediaRenderer4();};k.prototype.componentWillUnmount=function(){this.__destroy();};k.prototype.__destroy=function(){this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;};k.prototype.$SphericalMediaRenderer4=function(){if(this.$SphericalMediaRenderer2||!this.__isReadyToSetup()||!this.$SphericalMediaRenderer1||this.$SphericalMediaRenderer3)return;this.$SphericalMediaRenderer3=true;var l=this.__getCanvas();this.__getRenderer(l).done(function(m){m.updateViewportDimensions(this.props.width,this.props.height);m.addListener('renderingError',function(n,o){return this.__onWebGlRenderFailed(n,o);}.bind(this));m.addListener('renderingContextLost',function(){return this.__onWebGlContextLost();}.bind(this));c('DOM').setContent(this.$SphericalMediaRenderer1,l);this.sphericalRenderer=m;m.renderErrorCheck();this.$SphericalMediaRenderer3=false;this.__onSetupDone(m);}.bind(this),function(m){this.$SphericalMediaRenderer2=true;this.$SphericalMediaRenderer3=false;this.__onWebGlInitFailed(m);return;}.bind(this));};k.prototype.draw=function(l){if(!this.sphericalRenderer)return;var m=this.sphericalRenderer;if(!m)return;try{m.render(l);this.__afterDraw(m);}catch(n){this.__onWebGlRenderFailed(n,l);return;}};k.prototype.componentDidUpdate=function(){if(!this.props.isActive)return;var l=this.sphericalRenderer;if(!l){this.$SphericalMediaRenderer4();}else{l.updateViewportDimensions(this.props.width,this.props.height);this.draw(this.__getViewData());}};k.prototype.render=function(){var l=void 0,m=this.props.fallback;if(c('SphericalPhotoConfig').show_fallback_ui&&m&&this.props.showFallbackUI&&!c('SphericalPhotoConfig').show_fallback_ui_simple)return c('React').createElement('div',{className:"_183d",onClick:function(){return this.__onFallbackUIClick();}.bind(this),role:'link',tabIndex:'0'},c('React').createElement(c('BackgroundImage.react'),{className:"_183e",src:m.imageURI,width:this.props.width,height:this.props.height,backgroundSize:'contain'}));if(this.props.thumbnail)l=c('React').createElement(c('BackgroundImage.react'),{className:!this.__showLoadingThumbnail()||this.props.isActive&&this.sphericalRenderer?"hidden_elem":'',src:this.props.thumbnail,width:this.props.width,height:this.props.height,backgroundSize:'cover'});return c('React').createElement('div',null,c('React').createElement('div',{className:!this.props.isActive||!this.sphericalRenderer?"hidden_elem":'',ref:function(n){return this.$SphericalMediaRenderer1=n;}.bind(this)}),l);};f.exports=k;}),null);
__d("PhotoRendererProjection",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({PERSPECTIVE:"perspective",CYLINDRICAL:"cylindrical",EQUIRECTANGULAR:"equirectangular"});}),null);
__d("PhotoProjection",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({EQUIRECTANGULAR:"equirectangular",CUBESTRIP:"cubestrip",CYLINDRICAL:"cylindrical",TILED_CUBEMAP:"tiled_cubemap"});}),null);
__d('SphericalMediaBaseStore',['ReduxThunk','Redux'],(function a(b,c,d,e,f,g){'use strict';var h=c('Redux').compose,i=c('Redux').applyMiddleware,j=c('Redux').createStore,k=c('Redux').combineReducers;function l(){var m=arguments.length<=0||arguments[0]===undefined?[]:arguments[0],n=i.apply(undefined,[c('ReduxThunk')].concat(m)),o=k(this.getReducers());this.$SphericalMediaBaseStore1=h(n)(j)(o);}l.prototype.getStore=function(){return this.$SphericalMediaBaseStore1;};l.prototype.getReducers=function(){throw new Error('Implement _getReducers');};f.exports=l;}),null);
__d('SphericalMediaViewReducer',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';var h={fov:65,pitch:0,yaw:0,isAnimating:false},i=function j(){var k=arguments.length<=0||arguments[0]===undefined?h:arguments[0],l=arguments[1];if(l.namespace!==c('SphericalMediaActionNamespaces').VIEW)return k;var m={};switch(l.type){case c('SphericalMediaActions').UPDATE_VIEW:m=l.data;break;case c('SphericalMediaActions').UPDATE_VIEWPORT_AND_FOV:var n=l.data,o=n.pitch,p=n.fov,q=n.yaw;if(!isNaN(o+p+q)){m.fov=p;m.pitch=o;m.yaw=q;}break;case c('SphericalMediaActions').UPDATE_VIEWPORT:m=l.data;break;case c('SphericalMediaActions').UPDATE_FOV:m.fov=l.data.fov;break;case c('SphericalMediaActions').START_ANIMATING:m.isAnimating=true;break;case c('SphericalMediaActions').STOP_ANIMATING:m.isAnimating=false;break;}return babelHelpers['extends']({},k,m);};f.exports=i;}),null);
__d('SphericalMediaViewStore',['SphericalMediaBaseStore','SphericalMediaViewReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('SphericalMediaBaseStore'));i=h&&h.prototype;j.prototype.getReducers=function(){return {view:c('SphericalMediaViewReducer')};};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('SphericalMediaBaseRecord',['PhotoProjection','immutable','SphericalMediaViewStore'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('PhotoProjection').CUBESTRIP,k=c('immutable').Record({keyboardVelocityFactor:0,panningVelocityFactor:0,enableGyro:false,enablePartialLimit:false,enableRubberBanding:false,enableZoom:false,showFallbackUI:false,partialLeftDegrees:undefined,partialRightDegrees:undefined,partialTopDegrees:undefined,partialBottomDegrees:undefined,isPanning:false,hasInteracted:false,visibility:true,aspectRatio:1,height:0,width:0,initialFov:65,initialPitch:0,initialYaw:0,renderer:null,isRendererActive:false,isRendererSetup:false,className:'',projectionType:j,expansionCoef:undefined,tiledSphericalConfig:{useTiledRenderer:false,initialTileUris:[],viewportTileUris:[],maxTileLevel:0},canvasNamespace:'SphericalMedia',caption:'',type:'photo',src:'',flatImage:'',originalImageURI:'',thumbnail:'',fbid:'',loaded:false,enableSpherical:true,isFetchingData:false,photoSphereMetadata:{},exif:{},useLocalSphericalImage:false,fallback:null,fallbackCTAElement:null,enableTagging:false,tags:[],tagUnderMouse:null,tagClicked:null,isTagging:false,tagger:null,taggingMode:false,targetedTag:null,sourceProjectionType:null,surface:'',sessionID:'',viewStore:new (c('SphericalMediaViewStore'))().getStore(),ctrElement:null});h=babelHelpers.inherits(l,k);i=h&&h.prototype;function l(){h.apply(this,arguments);}f.exports=l;}),null);
__d('SphericalMediaBaseReducer',['SphericalMediaActionNamespaces','SphericalMediaActions','SphericalMediaBaseRecord','SphericalMediaViewStore','PhotoRendererProjection'],(function a(b,c,d,e,f,g){'use strict';var h=function j(){return new (c('SphericalMediaBaseRecord'))({viewStore:new (c('SphericalMediaViewStore'))().getStore()});},i=function j(){var k=arguments.length<=0||arguments[0]===undefined?h():arguments[0],l=arguments[1];if(l.namespace!==c('SphericalMediaActionNamespaces').CORE&&l.namespace!==c('SphericalMediaActionNamespaces').BASE)return k;switch(l.type){case c('SphericalMediaActions').UPDATE_BASE:var m=l.data;return k.withMutations(function(z){z.merge(m);if(m.photoSphereMetadata)z.set('photoSphereMetadata',m.photoSphereMetadata);if(m.tiledSphericalConfig)z.set('tiledSphericalConfig',m.tiledSphericalConfig);if(m.tags)z.set('tags',m.tags);if(m.tagUnderMouse)z.set('tagUnderMouse',m.tagUnderMouse);if(m.tagClicked)z.set('tagClicked',m.tagClicked);if(m.tagger)z.set('tagger',m.tagger);if(m.exif)z.set('exif',m.exif);if(m.fallback)z.set('fallback',m.fallback);});case c('SphericalMediaActions').DRAG_START:return k.withMutations(function(z){z.set('isPanning',true);z.set('hasInteracted',true);});case c('SphericalMediaActions').VISIBILITY_CHANGED:return k.set('visibility',l.data);case c('SphericalMediaActions').UPDATE_INITIAL_FOV:return k.set('initialFov',l.data.initialFov);case c('SphericalMediaActions').UPDATE_INITIAL_VIEWPORT:var n=l.data;return k.withMutations(function(z){z.set('initialYaw',n.initialYaw);z.set('initialPitch',n.initialPitch);});case c('SphericalMediaActions').UPDATE_DIMENSION:var o=l.data;return k.withMutations(function(z){z.set('height',o.height);z.set('width',o.width);z.set('aspectRatio',o.width/o.height);});case c('SphericalMediaActions').SETUP_RENDERER:var p=l.data.renderer;return k.withMutations(function(z){z.set('isRendererSetup',true);z.set('renderer',p);});case c('SphericalMediaActions').TURN_ON:return k.set('isRendererActive',true);case c('SphericalMediaActions').TURN_OFF:return k.withMutations(function(z){z.set('isRendererActive',false);z.set('isRendererSetup',false);z.set('renderer',null);});case c('SphericalMediaActions').REPLACE_BASE_STATE:return l.data;case c('SphericalMediaActions').SOURCE_ONLOAD:return k.set('loaded',true);case c('SphericalMediaActions').DISABLE_SPHERICAL:return k.set('enableSpherical',false);case c('SphericalMediaActions').ENABLE_SPHERICAL:return k.set('enableSpherical',true);case c('SphericalMediaActions').REQUEST_PHOTO:return k.withMutations(function(z){z.set('loaded',false);z.set('isFetchingData',true);});case c('SphericalMediaActions').RECEIVE_PHOTO:var q=l.data,r=q.partialLimits,s=q.photoSphereMetadata||{};return k.withMutations(function(z){z.set('fbid',q.photoID);z.set('flatImage',q.flatImage);z.set('initialFov',q.initialFov);z.set('initialPitch',q.initialPitch);z.set('initialYaw',q.initialYaw);z.set('isFetchingData',false);z.set('originalImageURI',q.originalImageURI);z.set('partialBottomDegrees',r.partialBottomDegrees);z.set('partialLeftDegrees',r.partialLeftDegrees);z.set('partialRightDegrees',r.partialRightDegrees);z.set('partialTopDegrees',r.partialTopDegrees);z.set('sourceProjectionType',s.ProjectionType);z.set('src',q.src);z.set('thumbnail',q.thumbnail);z.set('photoSphereMetadata',s);if(s&&(s.RendererProjectionType===c('PhotoRendererProjection').CYLINDRICAL||s.RendererProjectionType===c('PhotoRendererProjection').EQUIRECTANGULAR))z.set('enableSpherical',false);});case c('SphericalMediaActions').UPDATE_CTR_ELEM:return k.set('ctrElement',l.data.element);case c('SphericalMediaActions').ENABLE_TAGGING:return k.set('enableTagging',true);case c('SphericalMediaActions').DISABLE_TAGGING:return k.set('enableTagging',false);case c('SphericalMediaActions').UPDATE_SPATIAL_TAGS_FROM_COMPOSER:case c('SphericalMediaActions').UPDATE_SPATIAL_TAGS:var t=l.data;return k.withMutations(function(z){z.set('tags',t);});case c('SphericalMediaActions').UPDATE_TAG_UNDER_MOUSE:var u=l.data;return k.withMutations(function(z){z.set('tagUnderMouse',u);});case c('SphericalMediaActions').CANVAS_RESIZE_SUCCESS:var v=l.data;return k.withMutations(function(z){z.set('src',v);});case c('SphericalMediaActions').TAGGING_START:return k.set('isTagging',true);case c('SphericalMediaActions').TAGGING_STOP:return k.set('isTagging',false);case c('SphericalMediaActions').UPDATE_TAG_CLICKED:var w=l.data;return k.withMutations(function(z){z.set('tagClicked',w);});case c('SphericalMediaActions').UPDATE_TAGGER:var x=l.data;return k.withMutations(function(z){z.set('tagger',x);});case c('SphericalMediaActions').ENTER_TAGGING_MODE:return k.set('taggingMode',true);case c('SphericalMediaActions').EXIT_TAGGING_MODE:return k.set('taggingMode',false);case c('SphericalMediaActions').UPDATE_TARGETED_TAG:var y=l.data;return k.withMutations(function(z){z.set('targetedTag',y);});case c('SphericalMediaActions').SHOW_FALLBACK:return k.set('showFallbackUI',true);}return k;};f.exports=i;}),null);
__d('SphericalPhotoActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';f.exports={rendererStats:function h(i){return {namespace:c('SphericalMediaActionNamespaces').PHOTO,type:c('SphericalMediaActions').PHOTO_RENDERER_STATS,data:i};}};}),null);
__d('SphericalMediaTaggingUtils',['GLMatrix','SphericalPhotoProjectionUtils','SphericalProjectionUtils','degToRad','radToDeg'],(function a(b,c,d,e,f,g){'use strict';var h=c('GLMatrix').vec3,i={getSpatialTagArea:function j(k,l,m){var n=m.h/l.fov,o={w:Math.abs(k.width_degree)*n,h:Math.abs(k.height_degree)*n},p=c('SphericalProjectionUtils').convert3dTo2dScaledUnique(k.center.yaw,k.center.pitch,l.yaw,l.pitch,l.fov,m.w,m.h);return {topLeft:{x:p.x-o.w/2,y:p.y-o.h/2},bottomRight:{x:p.x+o.w/2,y:p.y+o.h/2}};},getSpatialTagAreaInNewPhotoRenderer:function j(k,l,m,n){var o=m.h/l.fov,p={w:Math.abs(k.width_degree)*o,h:Math.abs(k.height_degree)*o},q=c('SphericalPhotoProjectionUtils').convert3dTo2d(k.center.yaw,k.center.pitch,l,m.w,m.h,n);return {topLeft:{x:q.x-p.w/2,y:q.y-p.h/2},bottomRight:{x:q.x+p.w/2,y:q.y+p.h/2}};},isPointInTagArea:function j(k,l,m,n){var o=i.getSpatialTagArea(l,m,n);return !(o.topLeft.x>k.x||o.bottomRight.x<k.x||o.topLeft.y>k.y||o.bottomRight.y<k.y);},isPointInTagAreaInNewPhotoRenderer:function j(k,l,m,n,o){var p=i.getSpatialTagAreaInNewPhotoRenderer(l,m,n,o);return !(p.topLeft.x>k.x||p.bottomRight.x<k.x||p.topLeft.y>k.y||p.bottomRight.y<k.y);},pointsToRectSize:function j(k){var l=k.topLeft,m=k.bottomRight;return {w:Math.abs(m.x-l.x),h:Math.abs(m.y-l.y)};},rectSizeToPoints:function j(k,l){return {topLeft:k,bottomRight:{x:k.x+Math.abs(l.w),y:k.y+Math.abs(l.h)}};},rectSizeToDegreeSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return {widthDegree:k/o*360,heightDegree:l/n*180};},degreeSizeToRectSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return {w:k/360*o,h:l/180*n};},yawPitchToPhotoXY:function j(k,l,m){var n=Number(m.PosePitchDegrees),o=Number(m.PoseRollDegrees),p=Number(m.CroppedAreaImageHeightPixels),q=Number(m.CroppedAreaImageWidthPixels),r=Number(m.CroppedAreaLeftPixels),s=Number(m.CroppedAreaTopPixels),t=Number(m.FullPanoHeightPixels),u=Number(m.FullPanoWidthPixels),v=i.yawPitchToVec3(k,l),w=[v.x,v.y,v.z];if(n!==0)h.rotateX(w,w,[0,0,0],c('degToRad')(-n));if(o!==0)h.rotateZ(w,w,[0,0,0],c('degToRad')(o));var x=i.vec3ToPhotoXY(w[0],w[1],w[2]),y=x.x*u-r,z=x.y*t-s,aa=y/q,ba=z/p;return {x:aa,y:ba};},photoXYToYawPitch:function j(k,l){var m=Number(l.PosePitchDegrees),n=Number(l.PoseRollDegrees),o=Number(l.CroppedAreaImageHeightPixels),p=Number(l.CroppedAreaImageWidthPixels),q=Number(l.CroppedAreaLeftPixels),r=Number(l.CroppedAreaTopPixels),s=Number(l.FullPanoHeightPixels),t=Number(l.FullPanoWidthPixels),u=k.x*p,v=k.y*o,w=(u+q)/t,x=(v+r)/s,y=i.photoXYToVec3(w,x),z=[y.x,y.y,y.z];if(n!==0)h.rotateZ(z,z,[0,0,0],c('degToRad')(-n));if(m!==0)h.rotateX(z,z,[0,0,0],c('degToRad')(m));return i.vec3ToYawPitch.apply(i,z);},yawPitchToVec3:function j(k,l){var m=c('degToRad')(k),n=c('degToRad')(90-l),o=Math.abs(k)>90?1:-1,p=Math.tan(m)*-o;if(!isFinite(p))return {x:1,y:0,z:0};var q=Math.sqrt(p*p+o*o)/Math.tan(n);if(!isFinite(q))return {x:0,y:1,z:0};return {x:p,y:q,z:o};},vec3ToYawPitch:function j(k,l,m){var n=Math.atan2(Math.sqrt(k*k+m*m),l),o=Math.atan2(k,-m);return {yaw:c('radToDeg')(o),pitch:90-c('radToDeg')(n)};},vec3ToPhotoXY:function j(k,l,m){var n=Math.abs(Math.atan2(l,Math.sqrt(k*k+m*m)));if(l>0&&n<0)n*=-1;if(l<0&&n>0)n*=-1;n=(-n+Math.PI/2)/Math.PI;var o=-1*Math.atan2(k,m);if(o<0)o+=2*Math.PI;o/=2*Math.PI;return {x:o,y:n};},photoXYToVec3:function j(k,l){var m=(l-.5)*Math.PI,n=Math.sin(m),o=Math.cos(m),p=(k-.75)*2*Math.PI,q=Math.sin(p),r=Math.cos(p);k=r*o;l=-n;var s=q*o;return {x:k,y:l,z:s};},normalizeComposerXYToPhotoXY:function j(k){return k/100;},normalizePhotoXYToComposerXY:function j(k){return k*100;},coordinatesAreClose:function j(k,l){var m=arguments.length<=2||arguments[2]===undefined?.001:arguments[2],n=Math.abs(k.x-l.x),o=Math.abs(k.y-l.y);return !(n>m||o>m);},compareTags:function j(k,l){return !(k.center.pitch!==l.center.pitch||k.center.vec3[0]!==l.center.vec3[0]||k.center.vec3[1]!==l.center.vec3[1]||k.center.vec3[2]!==l.center.vec3[2]||k.center.yaw!==l.center.yaw||k.centerXY.x!==l.centerXY.x||k.centerXY.y!==l.centerXY.y||k.height_degree!==l.height_degree||k.width_degree!==l.width_degree);},getSpatialTagFromFBID:function j(k,l){for(var m=0;m<l.length;m++)if(l[m].fbid==k)return l[m];return null;}};f.exports=i;}),null);
__d('SphericalPhotoController.redux',['DOM','SphericalMediaController.react','SphericalMediaTaggingUtils','SphericalPhotoConfig','SphericalPhotoProjectionUtils','SphericalProjectionUtils','UserAgent','goURI','normalizeDeltaYaw','ReactRedux','SphericalMediaViewActions','SphericalMediaBaseActions','SphericalMediaConstants'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('ReactRedux').connect,k=c('SphericalProjectionUtils').convert3dTo2dScaledUnique,l=c('SphericalMediaViewActions').stopAnimating,m=c('SphericalMediaViewActions').updateViewportAndFOV,n=c('SphericalMediaViewActions').updateFOV,o=c('SphericalMediaBaseActions').dragStart,p=c('SphericalMediaBaseActions').gyroStart,q=c('SphericalMediaBaseActions').mouseEnter,r=c('SphericalMediaBaseActions').redirectFromClickedTag,s=c('SphericalMediaBaseActions').significantMove,t=c('SphericalMediaBaseActions').taggingStart,u=c('SphericalMediaBaseActions').taggingStop,v=c('SphericalMediaBaseActions').updateBase,w=c('SphericalMediaBaseActions').updateInitialViewport,x=c('SphericalMediaBaseActions').updateTagClicked,y=c('SphericalMediaBaseActions').updateTagUnderMouse,z=c('SphericalMediaBaseActions').viewportClicked,aa=c('SphericalMediaBaseActions').updateCtrElem,ba=c('SphericalMediaBaseActions').zoomStart,ca=c('SphericalMediaConstants').UNTAGGED_FACEBOX;h=babelHelpers.inherits(da,c('SphericalMediaController.react'));i=h&&h.prototype;function da(fa){i.constructor.call(this,fa);this.$SphericalPhotoController4=function(){this.onViewChange();}.bind(this);this.__onUpdateViewportBegin=function(){this.props.viewStore.dispatch(l());}.bind(this);this.__onUpdateViewportMoveStart=function(ga){var ha=this.props.dispatch;if(ga){ha(p());}else ha(o());}.bind(this);this.__onDOMClick=function(ga){if(this.props.enableTagging){this.props.taggingMode?this.$SphericalPhotoController8(ga):this.$SphericalPhotoController10(ga);var ha=this.$SphericalPhotoController7(ga);this.props.dispatch(x(ha));}this.props.dispatch(z());}.bind(this);this.__onViewportChange=function(ga,ha,ia){if(this.props.enableTagging){var ja=this.props,ka=ja.dispatch,la=ja.isTagging,ma=ja.tagger;if(la&&ma){ma.hideTagger();ka(u());}ka(x(null));}this.props.viewStore.dispatch(m(ga,ha,ia));}.bind(this);this.__onInitialViewportChange=function(ga,ha){this.props.dispatch(w(ga,ha));}.bind(this);this.__onZoomStart=function(){this.props.dispatch(ba());}.bind(this);this.__onMouseEnter=function(){this.props.dispatch(q());}.bind(this);this.__onMouseMove=function(ga){if(this.props.enableTagging){var ha=this.$SphericalPhotoController7(ga);if(ha){if(ha.type!==ca){this.__changeCursorStyle('pointer');}else this.__changeCursorStyle('crosshair');}else this.__changeCursorStyle(this.$SphericalPhotoController6());this.props.dispatch(y(this.$SphericalPhotoController7(ga)));}}.bind(this);}da.prototype.componentWillReceiveProps=function(fa){i.componentWillReceiveProps.call(this,fa);if(fa.isTagging){this.__sphericalViewportControl&&this.__sphericalViewportControl.disableKeyboard();}else this.__sphericalViewportControl&&this.__sphericalViewportControl.enableKeyboard();if(fa.enableTagging&&this.props.taggingMode!==fa.taggingMode)this.$SphericalPhotoController3(fa);};da.prototype.shouldComponentUpdate=function(fa){var ga=i.shouldComponentUpdate.call(this,fa)||this.props.tagger!==fa.tagger&&this.props.enableTagging;return ga;};da.prototype.componentDidMount=function(){i.componentDidMount.call(this);this.props.viewStore.subscribe(this.$SphericalPhotoController4);this.props.dispatch(aa(this.__viewport));this.props.enableTagging&&this.$SphericalPhotoController3(this.props);};da.prototype.componentDidUpdate=function(){i.componentDidUpdate.call(this);this.props.dispatch(aa(this.__viewport));this.props.enableTagging&&this.$SphericalPhotoController3(this.props);};da.prototype.componentWillUnmount=function(){i.componentWillUnmount.call(this);this.props.dispatch(aa(null));};da.prototype.$SphericalPhotoController3=function(fa){var ga=fa.tagger,ha=this.__sphericalViewportControl;if(ga&&ha){if(this.$SphericalPhotoController1){ha.removeLayer(this.$SphericalPhotoController1);this.$SphericalPhotoController1=null;}if(this.$SphericalPhotoController2){ha.removeLayer(this.$SphericalPhotoController2);this.$SphericalPhotoController2=null;}try{var ia=c('DOM').find(ga.tagger,'div.faceBox');this.$SphericalPhotoController1=ha.addNewLayer(ia);if(fa.taggingMode)this.$SphericalPhotoController2=ha.addNewLayer(ga.viewer.stageActions);}catch(ja){}}};da.prototype.$SphericalPhotoController5=function(fa){if(this.__sphericalViewportControl){this.__sphericalViewportControl.reconfigure(this.__getSphericalConfig(fa));fa.viewStore.dispatch(m(fa.initialYaw,fa.initialPitch,fa.initialFov));}};da.prototype.$SphericalPhotoController6=function(){var fa='grab';if(c('UserAgent').isEngine('WebKit')){fa='-webkit-'+fa;}else if(c('UserAgent').isEngine('Gecko'))fa='-moz-'+fa;return fa;};da.prototype.$SphericalPhotoController7=function(fa){var ga=this.__getViewportMousePosition(fa);if(!ga)return null;var ha=this.props,ia=ha.partialLeftDegrees,ja=ha.partialRightDegrees,ka=ha.partialTopDegrees,la=ha.partialBottomDegrees,ma=ha.showNewPhotoRenderer,na=ha.tags,oa=this.props.viewStore.getState(),pa=oa.view,qa=null;if(na)na.forEach(function(ra){if(ma&&c('SphericalMediaTaggingUtils').isPointInTagAreaInNewPhotoRenderer(ga,ra,pa,{w:this.props.width,h:this.props.height},{partialLeftDegrees:ia,partialRightDegrees:ja,partialTopDegrees:ka,partialBottomDegrees:la})||c('SphericalMediaTaggingUtils').isPointInTagArea(ga,ra,pa,{w:this.props.width,h:this.props.height}))qa=ra;}.bind(this));return qa;};da.prototype.$SphericalPhotoController8=function(fa){if(!this.props.tagger)return;var ga=this.$SphericalPhotoController7(fa),ha=this.__getViewData(),ia=this.props,ja=ia.height,ka=ia.partialLeftDegrees,la=ia.partialRightDegrees,ma=ia.partialTopDegrees,na=ia.partialBottomDegrees,oa=ia.photoSphereMetadata,pa=ia.showNewPhotoRenderer,qa=ia.width,ra={partialLeftDegrees:ka,partialRightDegrees:la,partialTopDegrees:ma,partialBottomDegrees:na},sa=void 0,ta=void 0,ua=void 0,va=void 0,wa=void 0;if(ga){if(ga.type!==ca){this.props.dispatch(r());ga.url&&c('goURI')(ga.url,true);return;}if(ga.type===ca){var xa=ga.center,ya=xa.yaw,za=xa.pitch;if(pa){sa=c('SphericalPhotoProjectionUtils').convert3dTo2d(ya,za,ha,qa,ja,ra);ta=c('SphericalMediaTaggingUtils').getSpatialTagAreaInNewPhotoRenderer(ga,ha,{w:qa,h:ja},ra);}else{sa=k(ya,za,ha.yaw,ha.pitch,ha.fov,qa,ja);ta=c('SphericalMediaTaggingUtils').getSpatialTagArea(ga,ha,{w:qa,h:ja});}va=ga.centerXY;ua=c('SphericalMediaTaggingUtils').pointsToRectSize(ta);wa=this.$SphericalPhotoController9(ga);}else return;}else{sa=this.__getViewportMousePosition(fa);ua={w:100};if(!sa)return;var ab=void 0;if(pa){ab=c('SphericalPhotoProjectionUtils').convert2dTo3d(sa.x,sa.y,ha,qa,ja,ra);}else ab=c('SphericalProjectionUtils').convert2dTo3dScaled(sa.x,sa.y,ha.yaw,ha.pitch,ha.fov,qa,ja);va=c('SphericalMediaTaggingUtils').yawPitchToPhotoXY(c('normalizeDeltaYaw')(ab.yaw),ab.pitch,oa);wa=null;}this.props.tagger.addSpatialTag({screenPos:sa,photoXY:va,suggestion:wa,size:ua.w,fromTag:!!ga,inTaggingMode:this.props.taggingMode},fa);this.props.dispatch(t());};da.prototype.$SphericalPhotoController10=function(fa){var ga=this.$SphericalPhotoController7(fa);if(ga){if(ga.type!==ca){this.props.dispatch(r());ga.url&&c('goURI')(ga.url,true);return;}else{if(!this.props.tagger)return;var ha=this.props,ia=ha.height,ja=ha.partialLeftDegrees,ka=ha.partialRightDegrees,la=ha.partialTopDegrees,ma=ha.partialBottomDegrees,na=ha.showNewPhotoRenderer,oa=ha.width,pa={partialLeftDegrees:ja,partialRightDegrees:ka,partialTopDegrees:la,partialBottomDegrees:ma},qa=ga.center,ra=qa.yaw,sa=qa.pitch,ta=this.__getViewData(),ua=void 0;if(na){ua=c('SphericalPhotoProjectionUtils').convert3dTo2d(ra,sa,ta,oa,ia,pa);}else ua=k(ra,sa,ta.yaw,ta.pitch,ta.fov,oa,ia);var va=ga.centerXY,wa=void 0;if(na){wa=c('SphericalMediaTaggingUtils').getSpatialTagAreaInNewPhotoRenderer(ga,ta,{w:oa,h:ia},pa);}else wa=c('SphericalMediaTaggingUtils').getSpatialTagArea(ga,ta,{w:oa,h:ia});var xa=c('SphericalMediaTaggingUtils').pointsToRectSize(wa),ya=this.$SphericalPhotoController9(ga);this.props.tagger.addSpatialTag({screenPos:ua,photoXY:va,suggestion:ya,size:xa.w,fromTag:true,inTaggingMode:this.props.taggingMode},fa);this.props.dispatch(t());}}else if(this.props.isTagging){this.props.tagger.hideTagger();this.props.dispatch(u());}};da.prototype.$SphericalPhotoController9=function(fa){if(!this.props.tagger||this.props.tagger.faceboxes.length<1)return null;var ga=null,ha=this.props.tagger.faceboxes;ha.forEach(function(ia){var ja=ia.rect,ka=ja.l,la=ja.r,ma=ja.t,na=ja.b,oa={x:ka+(la-ka)/2,y:ma+(na-ma)/2};try{var pa=JSON.parse(ia.node.getAttribute('data-recognizeduids'));if(c('SphericalMediaTaggingUtils').coordinatesAreClose(oa,fa.centerXY)&&pa.length>0)ga=ia;}catch(qa){ga=null;}});return ga;};da.prototype.__onUpdateViewportEnd=function(){this.props.dispatch(v({isPanning:false}));};da.prototype.__onSignificantMove=function(fa){this.props.dispatch(s(fa));};da.prototype.__updateFOV=function(fa){this.props.viewStore.dispatch(n(fa));};da.prototype.__getViewData=function(){var fa=this.props.viewStore.getState(),ga=fa.view;return {fov:ga.fov,pitch:ga.pitch,yaw:ga.yaw};};da.__subClassMethods={__getViewData:true,__onUpdateViewportBegin:true,__onUpdateViewportMoveStart:true,__onDOMClick:true,__onUpdateViewportEnd:true,__onViewportChange:true,__onInitialViewportChange:true,__onZoomStart:true,__onMouseEnter:true,__onMouseMove:true,__onSignificantMove:true,__updateFOV:true};var ea=function fa(ga){return {aspectRatio:ga.base.aspectRatio,caption:ga.base.caption,enableGyro:ga.base.enableGyro,enableRubberBanding:ga.base.enableRubberBanding,enableTagging:ga.base.enableTagging,enableZoom:ga.base.enableZoom,height:ga.base.height,initialFov:ga.base.initialFov,initialPitch:ga.base.initialPitch,initialYaw:ga.base.initialYaw,isActive:ga.base.isRendererActive&&ga.base.isRendererSetup,isTagging:ga.base.isTagging,keyboardVelocityFactor:ga.base.keyboardVelocityFactor,maxTileLevel:ga.base.tiledSphericalConfig.maxTileLevel,panningVelocityFactor:ga.base.panningVelocityFactor,partialBottomDegrees:ga.base.partialBottomDegrees,partialLeftDegrees:ga.base.partialLeftDegrees,partialRightDegrees:ga.base.partialRightDegrees,partialTopDegrees:ga.base.partialTopDegrees,photoSphereMetadata:ga.base.photoSphereMetadata,tagger:ga.base.tagger,taggingMode:ga.base.taggingMode,tags:ga.base.tags,showNewPhotoRenderer:ga.base.tiledSphericalConfig.useTiledRenderer&&c('SphericalPhotoConfig').show_new_renderer,viewStore:ga.base.viewStore,width:ga.base.width};};f.exports=j(ea)(da);}),null);
__d('SphericalPhotoFallbackMiddleware',['Bootloader','SphericalMediaActions','SphericalPhotoConfig','SphericalMediaBaseActions','CSS'],(function a(b,c,d,e,f,g){'use strict';var h=c('SphericalMediaBaseActions').showFallbackUI,i=function j(k){var l=k.dispatch,m=k.getState;return function(n){return function(o){if(c('SphericalPhotoConfig').show_fallback_ui)if(o.type===c('SphericalMediaActions').WEBGL_INIT_FAILED)c('Bootloader').loadModules(["genLoadedImgFromURL"],function(p){var q=m().base.fallback,r=m().base.fallbackCTAElement;if(q&&q.imageURI){p(q.imageURI).done(function(s){r&&c('CSS').show(r);l(h());});}else if(r)c('CSS').show(r);},'SphericalPhotoFallbackMiddleware');return n(o);};};};f.exports=i;}),null);
__d('CubemapImageTile',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j){this.$CubemapImageTile1=i;this.$CubemapImageTile2=j;}h.prototype.getInfo=function(){return this.$CubemapImageTile1;};h.prototype.getImg=function(){return this.$CubemapImageTile2;};f.exports=h;}),null);
__d('CubemapImageTileInfo',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k,l){this.level=i;this.face=j;this.col=k;this.row=l;}h.prototype.getKey=function(){return ''+this.level+'_'+this.face+'_'+this.col+'_'+this.row;};h.prototype.getInfoForOffsetLevel=function(i){var j=this.level-i;if(j<0)throw new Error('Invalid level offset for getKeyForOffsetLevel: '+i+', max offset: '+this.level);var k=Math.floor(this.col/Math.pow(2,i)),l=Math.floor(this.row/Math.pow(2,i));return new h(j,this.face,k,l);};f.exports=h;}),null);
__d('CubemapImageTileProvider',['CubemapImageTile','CubemapImageTileInfo','Map','SphericalMediaConstants','performanceNow'],(function a(b,c,d,e,f,g){'use strict';var h=c('SphericalMediaConstants').TILED_CUBE_FACES,i=c('SphericalMediaConstants').TILED_CUBE_TILE_CONTENT_SIZE,j=c('SphericalMediaConstants').TILED_CUBE_TILE_PADDING_PIXELS;function k(l,m,n){this.$CubemapImageTileProvider14=function(o,p,q){var r=new Image(),s=new (c('CubemapImageTile'))(o,r);r.crossOrigin='anonymous';r.onload=function(){return this.$CubemapImageTileProvider15(s,q);}.bind(this);r.src=p;}.bind(this);this.$CubemapImageTileProvider1=l;this.$CubemapImageTileProvider9=0;this.$CubemapImageTileProvider10={};this.$CubemapImageTileProvider2=false;this.$CubemapImageTileProvider3=[];this.$CubemapImageTileProvider4=[];this.$CubemapImageTileProvider5=new (c('Map'))();this.$CubemapImageTileProvider6=false;this.$CubemapImageTileProvider7=[];this.$CubemapImageTileProvider8=new (c('Map'))();this.$CubemapImageTileProvider11=m;this.$CubemapImageTileProvider12();if(n&&n.length){this.$CubemapImageTileProvider13(n);}else this.$CubemapImageTileProvider6=true;}k.prototype.getTileContentSize=function(){return i;};k.prototype.getTilePaddingPixels=function(){return j;};k.prototype.getTileTotalSize=function(){return 2*j+i;};k.prototype.getMaxTileLevel=function(){return this.$CubemapImageTileProvider11;};k.prototype.getTotalPixelsLoaded=function(){return this.$CubemapImageTileProvider9*Math.pow(this.getTileTotalSize(),2);};k.prototype.getBaseLevelImageTiles=function(){return this.$CubemapImageTileProvider5;};k.prototype.getViewportImageTiles=function(){return this.$CubemapImageTileProvider8;};k.prototype.addBaseLevelReadyCallback=function(l){if(!this.$CubemapImageTileProvider2){this.$CubemapImageTileProvider3.push(l);}else l();};k.prototype.isBaseLevelReady=function(){return this.$CubemapImageTileProvider2;};k.prototype.isViewportReady=function(){return this.$CubemapImageTileProvider6;};k.prototype.loadTileImage=function(l,m,n){var o=l.getKey();if(o in this.$CubemapImageTileProvider10){m(this.$CubemapImageTileProvider10[o],n);}else this.$CubemapImageTileProvider1.getUriForTile(l,function(p,q){this.$CubemapImageTileProvider14(p,q,m);}.bind(this));};k.prototype.$CubemapImageTileProvider12=function(){this.$CubemapImageTileProvider4=[new (c('CubemapImageTileInfo'))(0,h.PLUS_X,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_X,0,0),new (c('CubemapImageTileInfo'))(0,h.PLUS_Y,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_Y,0,0),new (c('CubemapImageTileInfo'))(0,h.PLUS_Z,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_Z,0,0)];this.$CubemapImageTileProvider4.forEach(function(l){return this.$CubemapImageTileProvider1.getUriForTile(l,this.$CubemapImageTileProvider14);}.bind(this));};k.prototype.$CubemapImageTileProvider13=function(l){l.forEach(function(m){var n=new (c('CubemapImageTileInfo'))(m.level,m.face,m.col,m.row);this.$CubemapImageTileProvider7.push(n);this.$CubemapImageTileProvider14(n,m.uri);}.bind(this));};k.prototype.$CubemapImageTileProvider15=function(l,m){var n=l.getInfo().getKey();this.$CubemapImageTileProvider10[n]=l;this.$CubemapImageTileProvider9++;if(!this.$CubemapImageTileProvider2){var o=this.$CubemapImageTileProvider4.every(function(q){return q.getKey() in this.$CubemapImageTileProvider10;}.bind(this)),p=this.$CubemapImageTileProvider7.length?this.$CubemapImageTileProvider7.every(function(q){return q.getKey() in this.$CubemapImageTileProvider10;}.bind(this)):true;if(l.getInfo().level===0){this.$CubemapImageTileProvider5.set(l.getInfo().getKey(),l);}else this.$CubemapImageTileProvider8.set(l.getInfo().getKey(),l);if(o&&p)this.$CubemapImageTileProvider16();}else m&&m(l,c('performanceNow')());};k.prototype.$CubemapImageTileProvider16=function(){this.$CubemapImageTileProvider2=true;this.$CubemapImageTileProvider6=true;this.$CubemapImageTileProvider3.forEach(function(l){return l();});};f.exports=k;}),null);
__d('BaseCubemapTileUriProvider',['invariant','CubemapImageTileInfo'],(function a(b,c,d,e,f,g,h){'use strict';i.prototype.getUriForTile=function(j,k){h(0);};function i(){}f.exports=i;}),null);
__d("XSphericalPhotoTileURIsAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/spherical_media\/photo\/tile\/",{});}),null);
__d('EntPhotoCubemapTileUriProvider',['Promise','BaseCubemapTileUriProvider','CubemapImageTileInfo','Map','XAsyncRequest','XSphericalPhotoTileURIsAsyncController','flattenPHPQueryData','throttle'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=200;h=babelHelpers.inherits(k,c('BaseCubemapTileUriProvider'));i=h&&h.prototype;function k(l,m){i.constructor.call(this);this.$EntPhotoCubemapTileUriProvider9=c('throttle')(function(){this.$EntPhotoCubemapTileUriProvider10(this.$EntPhotoCubemapTileUriProvider3);this.$EntPhotoCubemapTileUriProvider3=new (c('Map'))();}.bind(this),j);this.$EntPhotoCubemapTileUriProvider1=l;this.$EntPhotoCubemapTileUriProvider2=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider3=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider4=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider5=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider7(m);this.$EntPhotoCubemapTileUriProvider6=0;}k.prototype.getUriForTile=function(l,m){var n=l.getKey(),o=this.$EntPhotoCubemapTileUriProvider2.get(n);if(!o){if(this.$EntPhotoCubemapTileUriProvider5.has(n))return;this.$EntPhotoCubemapTileUriProvider8({tileInfo:l,onURIfetched:m});}else m(l,o);};k.prototype.$EntPhotoCubemapTileUriProvider8=function(l){var m=l.tileInfo.getKey(),n=this.$EntPhotoCubemapTileUriProvider3.get(m),o=this.$EntPhotoCubemapTileUriProvider4.get(m);if(!n&&!o){this.$EntPhotoCubemapTileUriProvider3.set(m,l);this.$EntPhotoCubemapTileUriProvider9();}};k.prototype.$EntPhotoCubemapTileUriProvider10=function(l){if(l.size===0)return new (c('Promise'))(function(){});var m=[];l.forEach(function(o){var p=o.tileInfo;this.$EntPhotoCubemapTileUriProvider4.set(p.getKey(),p);m.push({level:p.level,face:p.face,col:p.col,row:p.row});}.bind(this));var n={photo_id:this.$EntPhotoCubemapTileUriProvider1,tile_info_list:m};return this.$EntPhotoCubemapTileUriProvider11(c('XSphericalPhotoTileURIsAsyncController').getURIBuilder().getURI(),n).then(function(o){this.$EntPhotoCubemapTileUriProvider7(o.payload);l.forEach(function(p){var q=p.tileInfo,r=p.onURIfetched,s=q.getKey(),t=this.$EntPhotoCubemapTileUriProvider2.get(s);if(t){r(q,t);}else this.$EntPhotoCubemapTileUriProvider5.set(s,true);this.$EntPhotoCubemapTileUriProvider4['delete'](s);}.bind(this));}.bind(this),function(o){}.bind(this));};k.prototype.$EntPhotoCubemapTileUriProvider11=function(l,m){return new (c('Promise'))(function(n,o){return new (c('XAsyncRequest'))(l).setMethod('POST').setData(c('flattenPHPQueryData')(m)).setHandler(n).setErrorHandler(o).send();});};k.prototype.$EntPhotoCubemapTileUriProvider7=function(l){l.forEach(function(m){var n=new (c('CubemapImageTileInfo'))(m.level,m.face,m.col,m.row);this.$EntPhotoCubemapTileUriProvider2.set(n.getKey(),m.uri);}.bind(this));};f.exports=k;}),null);
__d('StaticCubemapTileUriProvider',['BaseCubemapTileUriProvider','CubemapImageTileInfo','Map'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('BaseCubemapTileUriProvider'));i=h&&h.prototype;function j(k){i.constructor.call(this);this.$StaticCubemapTileUriProvider1=new (c('Map'))();k.forEach(function(l){var m=new (c('CubemapImageTileInfo'))(l.level,l.face,l.col,l.row);this.$StaticCubemapTileUriProvider1.set(m.getKey(),l.uri);}.bind(this));}j.prototype.getUriForTile=function(k,l){var m=k.getKey(),n=this.$StaticCubemapTileUriProvider1.get(m);n&&l(k,n);};f.exports=j;}),null);
__d('BaseRotatableWebGLRenderer',['EventEmitter','EventListener','GLMatrix','Map','getErrorNameFromWebGLErrorCode','performanceNow','radToDeg'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('GLMatrix').glMatrix,k=c('GLMatrix').mat4,l=Math.max(window.devicePixelRatio||1,1),m=179;h=babelHelpers.inherits(n,c('EventEmitter'));i=h&&h.prototype;function n(o){i.constructor.call(this);this.__handleContextLost=function(q){q.preventDefault();this.emit('renderingContextLost');this.__contextLost=true;}.bind(this);this.__handleContextRestore=function(q){this.__setup();this.emit('renderingContextRestore');}.bind(this);if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var p in this.constructor.__subClassMethods)if(typeof this[p]!=='function')throw new Error('Must implement "'+p+'"');this.__firstRenderTime=-1;this.__previousRenderFinishTime=-1;this.__sumOfRenderTimes=0;this.__framesRenderedCount=0;this.__sumTextureScreenRatioValues=0;this.__textureScreenRatioMillisCounted=0;this.__canvas=o;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__shaders=[];this.__contextLost=false;this.__horizontalFieldOfView=0;this.__verticalFieldOfView=0;this.__perspectiveMatrix=k.create();this.__rotationMatrix=k.create();this.__shouldEnableBlend=false;this.__useVfovAsIs=false;this.__canvas.addEventListener('webglcontextlost',this.__handleContextLost);this.__canvas.addEventListener('webglcontextrestored',this.__handleContextRestore);}n.prototype.destroy=function(){this.__canvas.removeEventListener('webglcontextlost',this.__handleContextLost);this.__canvas.removeEventListener('webglcontextrestored',this.__handleContextRestore);this.__shaders.forEach(function(o){try{this.__gl.detachShader(this.__shaderProgram,o);}catch(p){}}.bind(this));this.__shaders=[];this.__clearCache();this.__destroyed=true;};n.prototype.updateFieldOfView=function(o){var p=Math.min(o,m/this.__aspectRatio);if(this.__useVfovAsIs)p=o;var q=Math.min(m,p);this.__verticalFieldOfView=q;this.__updateHorizontalFieldOfView();this.__updatePerspective();};n.prototype.updateViewportDimensions=function(o,p){this.__canvas.width=o*l;this.__canvas.height=p*l;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__updateHorizontalFieldOfView();this.__updatePerspective();};n.prototype.hasRenderingContext=function(){return !this.__contextLost;};n.prototype.getScreenshotDataURL=function(o,p,q){if(!this.__gl||this.__contextLost)return '';this.render(o);return this.__canvas.toDataURL(p,q);};n.prototype.getAverageFrameRenderTimeMillis=function(){if(this.__framesRenderedCount===0)return 0;return this.__sumOfRenderTimes/this.__framesRenderedCount;};n.prototype.getMaxGPUMemoryUsedBytes=function(){return this.__getMaxGPUMemoryUsedBytes();};n.prototype.getAverageTextureToScreenPixelRatio=function(){if(this.__textureScreenRatioMillisCounted===0)return 0;return this.__sumTextureScreenRatioValues/this.__textureScreenRatioMillisCounted;};n.prototype.getTimeSinceFirstRenderMillis=function(){return c('performanceNow')()-this.__firstRenderTime;};n.prototype.renderErrorCheck=function(){this.__createTexture();};n.prototype.render=function(o){if(this.__contextLost||this.__destroyed)return;this.__view=o;if(!this.__isValidView(o)){this.emit('renderingError',new Error('invalid view'),o);return;}var p=c('performanceNow')();if(this.__firstRenderTime===-1)this.__firstRenderTime=p;if(o.fov!==this.__verticalFieldOfView)this.updateFieldOfView(o.fov);k.identity(this.__rotationMatrix);k.rotateX(this.__rotationMatrix,this.__rotationMatrix,-j.toRadian(o.pitch));k.rotateY(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(o.yaw));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);var q=this.__getPrevFrameTextureScreenRatio();this.__renderInternal();var r=c('performanceNow')();this.__sumOfRenderTimes+=r-p;this.__framesRenderedCount+=1;if(this.__previousRenderFinishTime>0){var s=2000,t=Math.min(r-this.__previousRenderFinishTime,s);this.__sumTextureScreenRatioValues+=t*q;this.__textureScreenRatioMillisCounted+=t;}this.__previousRenderFinishTime=r;};n.prototype.renderWithRotationMatrixForMSite=function(o){k.rotateX(o,o,j.toRadian(90));this.renderWithRotationMatrix(o);};n.prototype.renderWithRotationMatrix=function(o){if(this.__contextLost)return;this.__rotationMatrix=o;this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);this.__renderInternal();};n.prototype.__isValidView=function(o){return !Number.isNaN(o.fov+o.pitch+o.yaw);};n.prototype.__copyTextureToGLBuffer=function(o,p){var q=arguments.length<=2||arguments[2]===undefined?false:arguments[2],r=this.__getNewGLTexObj(p);this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,q);this.__gl.bindTexture(this.__gl.TEXTURE_2D,r);this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,o.image);var s=this.__gl.getError();if(s!==0)this.__emitRenderingError(s);return r;};n.prototype.__setup=function(){if(!this.__gl||!this.__contextLost){this.__gl=this.__getGL();this.__contextLost=false;}this.__gl.clearColor(0,0,0,1);if(this.__shouldEnableBlend){this.__gl.enable(this.__gl.BLEND);this.__gl.blendFunc(this.__gl.SRC_ALPHA,this.__gl.ONE_MINUS_SRC_ALPHA);}this.updateViewportDimensions(this.__canvas.clientWidth,this.__canvas.clientHeight);var o=this.__initShaders();if(!o.success){var p=c('getErrorNameFromWebGLErrorCode')(this.__gl.getError());throw new Error('\n        Failed to intialize shaders: '+p+'\n        Error Message: '+o.error+'\n      ');}};n.prototype.__getGL=function(){if(this.__gl&&!this.__contextLost)return this.__gl;if(!b.WebGLRenderingContext)throw new Error('WebGLRenderingContext not available.');var o=['webgl','experimental-webgl','webkit-3d','moz-webgl'],p=null,q=null,r=c('EventListener').listen(this.__canvas,'webglcontextcreationerror',function(t){return q=t.statusMessage;});for(var s=0;s<o.length;s++){try{p=this.__canvas.getContext(o[s]);}catch(t){}if(p)break;}r.remove();if(!p){q=q||'Unknown error.';throw new Error('Failed to acquire 3D rendering context: '+q);}return p;};n.prototype.__updatePerspective=function(){k.perspective(this.__perspectiveMatrix,j.toRadian(this.__verticalFieldOfView),this.__aspectRatio,.1,100);this.__gl.viewport(0,0,this.__gl.drawingBufferWidth,this.__gl.drawingBufferHeight);};n.prototype.__initShaders=function(){this.__shaderProgram=this.__gl.createProgram();try{this.__attachShaders(this.__shaderProgram);}catch(p){return {success:false,error:'Shader: '+p.message};}this.__gl.linkProgram(this.__shaderProgram);var o=this.__gl.getProgramParameter(this.__shaderProgram,this.__gl.LINK_STATUS);if(!o)return {success:false,error:'No link. Could not initialize shaders'};this.__gl.useProgram(this.__shaderProgram);this.__setShaderMatrixPointers();this.__shaderProgramReady();return {success:true,error:''};};n.prototype.__setShaderMatrixPointers=function(){this.__shaderPMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderPerspectiveMatrixUniformName());this.__shaderRotMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderRotationMatrixUniformName());};n.prototype.__getShaderConfigs=function(){var o=new (c('Map'))();o.set(this.__gl.VERTEX_SHADER,this.__getVertexShaderScript());o.set(this.__gl.FRAGMENT_SHADER,this.__getFragmentShaderScript());return o;};n.prototype.__attachShaders=function(o){var p=this.__getShaderConfigs();p.forEach(function(q,r){var s=this.__gl.createShader(r);this.__gl.shaderSource(s,q);this.__gl.compileShader(s);if(!this.__gl.getShaderParameter(s,this.__gl.COMPILE_STATUS))throw new Error(this.__gl.getShaderInfoLog(s));this.__gl.attachShader(o,s);this.__shaders.push(s);}.bind(this));};n.prototype.__getNewGLTexObj=function(o){var p=this.__gl.createTexture();this.__gl.bindTexture(o,p);this.__gl.texParameteri(o,this.__gl.TEXTURE_MAG_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_MIN_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_S,this.__gl.CLAMP_TO_EDGE);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_T,this.__gl.CLAMP_TO_EDGE);this.__gl.bindTexture(o,null);return p;};n.prototype.__updateHorizontalFieldOfView=function(){var o=j.toRadian(this.__verticalFieldOfView),p=2*Math.atan(Math.tan(o/2)*this.__aspectRatio);this.__horizontalFieldOfView=c('radToDeg')(p);};n.prototype.__emitRenderingError=function(o){this.emit('renderingError',new Error('WebGL Error Code: '+o));};f.exports=n;}),null);
__d('TileRendererState',['CubemapImageTileInfo'],(function a(b,c,d,e,f,g){'use strict';var h=1000,i=1000;function j(k,l){this.tileInfo=k;this.blendingProgress=0;this.closestCoveringTile=l;this.closestPrevTile=l;this.durationInViewMS=0;this.isInView=true;}j.prototype.enterView=function(k){this.blendingProgress=1;this.closestCoveringTile=k;this.closestPrevTile=k;this.durationInViewMS=0;this.isInView=true;};j.prototype.exitView=function(){this.closestCoveringTile=null;this.closestPrevTile=null;this.isInView=false;};j.prototype.shouldFetch=function(k){return this.durationInViewMS<h&&this.durationInViewMS+k>=h;};j.prototype.update=function(k,l){this.updateBlendingProgress(k,l);this.durationInViewMS+=k;};j.prototype.updateBlendingProgress=function(k,l){if(!l||!this.closestCoveringTile)return;var m=l.level-this.closestCoveringTile.level;if(m>0){this.closestCoveringTile=l;this.blendingProgress=this.blendingProgress>=1?0:this.blendingProgress/(1*Math.pow(2,m));}if(this.blendingProgress<1)this.blendingProgress=Math.min(this.blendingProgress+1*k/i,1);};f.exports=j;}),null);
__d('TiledSphericalRenderer',['BaseRotatableWebGLRenderer','CubemapImageTileInfo','GLMatrix','Map','SphericalMediaConstants','TileRendererState','debounceCore','performanceNow','throttle'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('GLMatrix').glMatrix,k=c('GLMatrix').mat4,l=c('GLMatrix').vec3,m=c('SphericalMediaConstants').TILED_CUBE_FACES,n=44;h=babelHelpers.inherits(o,c('BaseRotatableWebGLRenderer'));i=h&&h.prototype;function o(p,q,r,s){i.constructor.call(this,p);this.$TiledSphericalRenderer43=function(t,u){var v=t.getInfo().getKey();this.$TiledSphericalRenderer7.set(v,t);if(u!==this.$TiledSphericalRenderer10){this.$TiledSphericalRenderer10=this.$TiledSphericalRenderer8;setTimeout(this.$TiledSphericalRenderer44,0);}}.bind(this);this.$TiledSphericalRenderer45=c('debounceCore')(function(){return this.__renderInternal();}.bind(this),30);this.$TiledSphericalRenderer35=c('throttle')(function(){return this.__renderInternal();}.bind(this),100);this.$TiledSphericalRenderer48=c('debounceCore')(function(){var t=this.$TiledSphericalRenderer7;this.$TiledSphericalRenderer7=new (c('Map'))();this.$TiledSphericalRenderer31();this.$TiledSphericalRenderer12.forEach(function(u){return setTimeout(function(){return this.$TiledSphericalRenderer46(u,t);}.bind(this),0);}.bind(this));}.bind(this),100);this.$TiledSphericalRenderer44=c('throttle')(function(){var t=this.$TiledSphericalRenderer7;this.$TiledSphericalRenderer7=new (c('Map'))();this.$TiledSphericalRenderer31();this.$TiledSphericalRenderer12.forEach(function(u){return setTimeout(function(){return this.$TiledSphericalRenderer46(u,t);}.bind(this),0);}.bind(this));}.bind(this),100);this.$TiledSphericalRenderer1=q;this.$TiledSphericalRenderer2=r;this.$TiledSphericalRenderer3=1;this.$TiledSphericalRenderer6=0;this.$TiledSphericalRenderer8=-1;this.$TiledSphericalRenderer9=-1;this.$TiledSphericalRenderer10=0;this.$TiledSphericalRenderer4=new (c('Map'))();this.$TiledSphericalRenderer5=new (c('Map'))();this.$TiledSphericalRenderer7=new (c('Map'))();this.$TiledSphericalRenderer11=[];this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer13=new (c('Map'))();this.$TiledSphericalRenderer14=[];this.$TiledSphericalRenderer15=new (c('Map'))();this.$TiledSphericalRenderer16=0;this.$TiledSphericalRenderer26();this.__setup();}o.prototype.__clearCache=function(){this.$TiledSphericalRenderer27();this.$TiledSphericalRenderer14=[];this.$TiledSphericalRenderer5.forEach(function(p){this.__gl.deleteTexture(p);}.bind(this));this.$TiledSphericalRenderer5.clear();this.$TiledSphericalRenderer4.forEach(function(p){this.__gl.deleteTexture(p.texture);}.bind(this));this.$TiledSphericalRenderer4.clear();this.$TiledSphericalRenderer15.clear();};o.prototype.__getShaderPerspectiveMatrixUniformName=function(){return 'uPMatrix';};o.prototype.__getShaderRotationMatrixUniformName=function(){return 'uRotationMatrix';};o.prototype.__shaderProgramReady=function(){this.$TiledSphericalRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,'aVertexPosition');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer19);this.$TiledSphericalRenderer20=this.__gl.getAttribLocation(this.__shaderProgram,'aTextureCoord');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer20);this.$TiledSphericalRenderer21=this.__gl.getAttribLocation(this.__shaderProgram,'aBGTextureCoord');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer21);var p=this.__gl.getUniformLocation(this.__shaderProgram,'uContentSampler'),q=this.__gl.getUniformLocation(this.__shaderProgram,'uBackgroundSampler'),r=0;this.$TiledSphericalRenderer23=this.__gl.TEXTURE0;var s=1;this.$TiledSphericalRenderer24=this.__gl.TEXTURE1;this.__gl.uniform1i(p,r);this.__gl.uniform1i(q,s);this.$TiledSphericalRenderer22=this.__gl.getAttribLocation(this.__shaderProgram,'aPrevLevelTextureCoord');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer22);var t=this.__gl.getUniformLocation(this.__shaderProgram,'uPrevLevelSampler'),u=2;this.$TiledSphericalRenderer25=this.__gl.TEXTURE2;this.__gl.uniform1i(t,u);this.$TiledSphericalRenderer28();};o.prototype.__getVertexShaderScript=function(){return '\n      attribute vec3 aVertexPosition;\n      attribute vec2 aTextureCoord;\n      attribute vec2 aBGTextureCoord;\n      attribute vec2 aPrevLevelTextureCoord;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vTextureCoord = aTextureCoord;\n        vBGTextureCoord = aBGTextureCoord;\n        vPrevLevelTextureCoord = aPrevLevelTextureCoord;\n      }\n    ';};o.prototype.__getFragmentShaderScript=function(){return '\n      #define PI 3.1415926538\n\n      precision highp float;\n      // 1 degree blend zone\n      const highp float blendDist = PI / 180.0;\n\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      varying highp vec3 vCurrentRay;\n      uniform highp vec2 uHorizontalAngleBounds;\n      uniform highp vec2 uVerticleAngleBounds;\n\n      uniform sampler2D uContentSampler;\n      uniform sampler2D uBackgroundSampler;\n      uniform sampler2D uPrevLevelSampler;\n\n      uniform float progress;\n\n      void main(void) {\n        highp float x = vCurrentRay[0];\n        highp float y = vCurrentRay[1];\n        highp float z = vCurrentRay[2];\n        highp float hAngle = atan(x, -1.0 * z);\n        highp float vAngle = atan(y * inversesqrt(x*x + z*z));\n\n        // if current ray is inside the content bounds, use the content sampler\n        // to set the fragment color. if it is not within the bounds, use the\n        // background sampler to set the color.*\n\n        highp float hdist = 0.0;\n        highp float vdist = 0.0;\n        if (hAngle < uHorizontalAngleBounds[0]) {\n          hdist = uHorizontalAngleBounds[0] - hAngle;\n        } else if (hAngle > uHorizontalAngleBounds[1]) {\n          hdist = hAngle - uHorizontalAngleBounds[1];\n        }\n        if (vAngle < uVerticleAngleBounds[0]) {\n          vdist = uVerticleAngleBounds[0] - vAngle;\n        } else if (vAngle > uVerticleAngleBounds[1]) {\n          vdist = vAngle - uVerticleAngleBounds[1];\n        }\n        highp float maxDist = max(hdist, vdist);\n        highp vec4 bgColor = texture2D(\n          uBackgroundSampler,\n          vec2(vBGTextureCoord.s, vBGTextureCoord.t)\n        );\n        highp vec4 contentColor = texture2D(\n          uContentSampler,\n          vec2(vTextureCoord.s, vTextureCoord.t)\n        );\n        if (maxDist > 0.0) {\n          // Inside this condition, our fragment is outside the content bounds.\n          // The distance outside the bound is represented by maxDist. It could\n          // be the horizontal or vertical distance from a bound, whichever is\n          // larger. We will use this distance to blend the content with the\n          // background, if the distance is smaller than blendDist. If it is\n          // larger than blendDist, we will use purely the background tex to\n          // set the color. If dist is within the blendDist, then we will set\n          // the color to the linearly weighted avg across the blend zone of the\n          // background and content colors.\n          //\n          if (maxDist < blendDist) {\n            highp float contentWeight = (blendDist - maxDist) / blendDist;\n            gl_FragColor = mix(bgColor, contentColor, contentWeight);\n          } else {\n            // We are outside the blend zone. Just use background.\n            gl_FragColor = bgColor;\n          }\n        } else {\n          // In this condition, we are inside the content\n          highp vec4 prevLevelColor = texture2D(\n            uPrevLevelSampler,\n            vec2(vPrevLevelTextureCoord.s, vPrevLevelTextureCoord.t)\n          );\n          gl_FragColor = mix(prevLevelColor, contentColor, progress);\n        }\n      }\n      ';};o.prototype.__getMaxGPUMemoryUsedBytes=function(){var p=this.$TiledSphericalRenderer1.getTileTotalSize(),q=4,r=this.$TiledSphericalRenderer4.size+this.$TiledSphericalRenderer5.size;return p*p*q*r;};o.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledSphericalRenderer6;};o.prototype.__createTexture=function(){if(this.$TiledSphericalRenderer5.size===0&&this.$TiledSphericalRenderer1.isBaseLevelReady())this.$TiledSphericalRenderer29();if(this.$TiledSphericalRenderer4.size===0&&this.$TiledSphericalRenderer1.isViewportReady())this.$TiledSphericalRenderer30();};o.prototype.__renderInternal=function(){if(this.__destroyed||!this.$TiledSphericalRenderer1.isBaseLevelReady()&&!this.$TiledSphericalRenderer1.isViewportReady())return;this.__createTexture();this.$TiledSphericalRenderer9=this.$TiledSphericalRenderer8!=-1?this.$TiledSphericalRenderer8:c('performanceNow')();this.$TiledSphericalRenderer8=c('performanceNow')();this.$TiledSphericalRenderer31();this.$TiledSphericalRenderer32();var p=0,q=false;this.$TiledSphericalRenderer12.forEach(function(s){var t=this.$TiledSphericalRenderer15.get(s.getKey()),u=t?t.blendingProgress:0;if(u<1)q=true;p+=this.$TiledSphericalRenderer33(s);}.bind(this));var r=this.$TiledSphericalRenderer12.length>0?this.$TiledSphericalRenderer12.length:1;p/=r;this.$TiledSphericalRenderer6=p;if(q){this.$TiledSphericalRenderer34();}else this.$TiledSphericalRenderer27();};o.prototype.$TiledSphericalRenderer34=function(){if(this.$TiledSphericalRenderer16===0)this.$TiledSphericalRenderer16=setInterval(function(){return this.$TiledSphericalRenderer35();}.bind(this),200);};o.prototype.$TiledSphericalRenderer27=function(){if(this.$TiledSphericalRenderer16!==0){clearInterval(this.$TiledSphericalRenderer16);this.$TiledSphericalRenderer16=0;}};o.prototype.$TiledSphericalRenderer28=function(){var p=this.__gl.getUniformLocation(this.__shaderProgram,'uHorizontalAngleBounds'),q=this.__gl.getUniformLocation(this.__shaderProgram,'uVerticleAngleBounds'),r=this.$TiledSphericalRenderer2.partialLeftDegrees,s=this.$TiledSphericalRenderer2.partialRightDegrees,t=this.$TiledSphericalRenderer2.partialTopDegrees,u=this.$TiledSphericalRenderer2.partialBottomDegrees,v=r!==undefined&&r!==null?-1*r:-181,w=s!==undefined&&s!==null?s:181,x=u!==undefined&&u!==null?-1*u:-91,y=t!==undefined&&t!==null?t:91,z=new Float32Array([j.toRadian(v),j.toRadian(w)]),aa=new Float32Array([j.toRadian(x),j.toRadian(y)]);this.__gl.uniform2fv(p,z);this.__gl.uniform2fv(q,aa);};o.prototype.$TiledSphericalRenderer31=function(){this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer13.clear();var p=this.$TiledSphericalRenderer36(),q=this.$TiledSphericalRenderer37(),r=Math.pow(2,p),s=2*this.$TiledSphericalRenderer3/r;for(var t=0;t<q.length;t++){var u=q[t];if(u){var v=Math.floor(u.minX/s),w=Math.min(Math.floor(u.maxX/s),r-1),x=Math.floor(u.minY/s),y=Math.min(Math.floor(u.maxY/s),r-1);for(var z=v;z<=w;z++)for(var aa=x;aa<=y;aa++){var ba=new (c('CubemapImageTileInfo'))(p,t,z,aa);this.$TiledSphericalRenderer12.push(ba);this.$TiledSphericalRenderer13.set(ba.getKey(),true);}}}};o.prototype.$TiledSphericalRenderer32=function(){this.$TiledSphericalRenderer14.forEach(function(p){var q=p.getKey();if(!this.$TiledSphericalRenderer13.has(q)){var r=this.$TiledSphericalRenderer15.get(q);if(r)r.exitView();}}.bind(this));this.$TiledSphericalRenderer14=[];this.$TiledSphericalRenderer12.forEach(function(p){this.$TiledSphericalRenderer14.push(p);var q=p.getKey(),r=this.$TiledSphericalRenderer15.get(q),s=this.$TiledSphericalRenderer38(p);if(!r){r=new (c('TileRendererState'))(p,s);this.$TiledSphericalRenderer15.set(q,r);}else if(!r.isInView){r.enterView(s);}else{var t=this.$TiledSphericalRenderer8-this.$TiledSphericalRenderer9;if(r.shouldFetch(t))this.$TiledSphericalRenderer39(p);r.update(t,s);}}.bind(this));};o.prototype.$TiledSphericalRenderer36=function(){var p=this.__verticalFieldOfView,q=this.__horizontalFieldOfView,r=this.__canvas.height/p,s=3400/2,t=0,u=this.$TiledSphericalRenderer1.getTileContentSize()/90,v=1.4;while(u*v<r&&u*p<s&&u*q<s){t++;u*=2;}return Math.min(t,this.$TiledSphericalRenderer1.getMaxTileLevel());};o.prototype.$TiledSphericalRenderer37=function(){var p=j.toRadian(this.__verticalFieldOfView),q=j.toRadian(this.__horizontalFieldOfView),r=1,s=Math.tan(q/2)*r,t=Math.tan(p/2)*r,u=[l.fromValues(-s,t,-r),l.fromValues(s,t,-r),l.fromValues(s,-t,-r),l.fromValues(-s,-t,-r)],v=k.create();k.invert(v,this.__rotationMatrix);this.$TiledSphericalRenderer40(v,u);var w=[];for(var x=0;x<6;x++){var y=this.$TiledSphericalRenderer18[x],z=[];for(var aa=0;aa<y.length;aa++)z.push(l.clone(y[aa]));var ba=this.$TiledSphericalRenderer41(z,u);if(ba.length>0){var ca=k.create();k.invert(ca,this.$TiledSphericalRenderer17[x]);this.$TiledSphericalRenderer40(ca,ba);var da=ba[0],ea=da[0],fa=da[0],ga=da[1],ha=da[1];for(var ia=1;ia<ba.length;ia++){da=ba[ia];ea=Math.min(ea,da[0]);fa=Math.max(fa,da[0]);ga=Math.min(ga,da[1]);ha=Math.max(ha,da[1]);}w[x]={minX:this.$TiledSphericalRenderer3+ea,maxX:this.$TiledSphericalRenderer3+fa,minY:this.$TiledSphericalRenderer3-ha,maxY:this.$TiledSphericalRenderer3-ga};}}return w;};o.prototype.$TiledSphericalRenderer40=function(p,q){for(var r=0;r<q.length;r++)l.transformMat4(q[r],q[r],p);};o.prototype.$TiledSphericalRenderer41=function(p,q){var r=q[q.length-1];for(var s=0;s<q.length;s++){var t=q[s],u=[],v=l.create();l.cross(v,r,t);var w=p[p.length-1],x=l.dot(v,w),y=x>=0;for(var z=0;z<p.length;z++){var aa=p[z],ba=l.dot(v,aa),ca=ba>=0;if(ca!==y){var da=this.$TiledSphericalRenderer42(w,x,aa,ba);if(!l.exactEquals(w,da)&&!l.exactEquals(aa,da))u.push(da);}if(ca)u.push(aa);w=aa;x=ba;y=ca;}p=u;if(p.length===0)break;r=t;}return p;};o.prototype.$TiledSphericalRenderer42=function(p,q,r,s){var t=-q/(s-q),u=l.create();l.subtract(u,r,p);l.scale(u,u,t);l.add(u,u,p);return u;};o.prototype.$TiledSphericalRenderer46=function(p,q){var r=p.getKey(),s=q.get(r);if(s){this.$TiledSphericalRenderer47(s);this.$TiledSphericalRenderer35();}};o.prototype.$TiledSphericalRenderer33=function(p){var q=p.getKey(),r=void 0,s=void 0,t=void 0;r=this.$TiledSphericalRenderer15.get(q);if(!r)return 0;s=r.closestCoveringTile;t=r.closestPrevTile;if(!s||!t)return 0;var u=2*this.$TiledSphericalRenderer3,v=this.$TiledSphericalRenderer3,w=Math.pow(2,p.level),x=u/w,y=p.col*x,z=p.row*x,aa=-v+y,ba=aa+x,ca=v-z,da=ca-x,ea=[[aa,ca,-v],[ba,ca,-v],[aa,da,-v],[ba,da,-v]],fa=this.$TiledSphericalRenderer17[p.face],ga=[];for(var ha=0;ha<ea.length;ha++){l.transformMat4(ea[ha],ea[ha],fa);ga.push(ea[ha][0]);ga.push(ea[ha][1]);ga.push(ea[ha][2]);}var ia={};this.$TiledSphericalRenderer49(this.$TiledSphericalRenderer19,ga,3);this.__gl.activeTexture(this.$TiledSphericalRenderer23);if(s){ia=this.$TiledSphericalRenderer50(s);}else ia=this.$TiledSphericalRenderer51(p);var ja=this.$TiledSphericalRenderer52(p,ia);this.$TiledSphericalRenderer49(this.$TiledSphericalRenderer20,ja,2);this.__gl.activeTexture(this.$TiledSphericalRenderer24);var ka=new (c('CubemapImageTileInfo'))(0,p.face,0,0),la=this.$TiledSphericalRenderer5.get(ka.getKey());if(!la)throw new Error('[Tile] Base level should have been loaded.');this.__gl.bindTexture(this.__gl.TEXTURE_2D,la);var ma=this.$TiledSphericalRenderer52(p,ka);this.$TiledSphericalRenderer49(this.$TiledSphericalRenderer21,ma,2);if(r&&t){this.__gl.activeTexture(this.$TiledSphericalRenderer25);ia=this.$TiledSphericalRenderer50(t);var na=this.$TiledSphericalRenderer52(p,ia);this.$TiledSphericalRenderer49(this.$TiledSphericalRenderer22,na,2);var oa=this.__gl.getUniformLocation(this.__shaderProgram,'progress');this.__gl.uniform1f(oa,r.blendingProgress);}this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,ga.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledSphericalRenderer11.forEach(function(pa){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,pa);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW);this.__gl.deleteBuffer(pa);}.bind(this));this.$TiledSphericalRenderer11=[];return this.$TiledSphericalRenderer53(ia.level);};o.prototype.$TiledSphericalRenderer49=function(p,q,r){var s=this.__gl.createBuffer();this.$TiledSphericalRenderer11.push(s);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,s);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(q),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(p,r,this.__gl.FLOAT,false,0,0);};o.prototype.$TiledSphericalRenderer53=function(p){var q=this.__canvas.height/this.__verticalFieldOfView,r=90/Math.pow(2,p),s=this.$TiledSphericalRenderer1.getTileContentSize()/r;return s/q;};o.prototype.$TiledSphericalRenderer52=function(p,q){var r=this.$TiledSphericalRenderer1.getTilePaddingPixels(),s=r/this.$TiledSphericalRenderer1.getTileTotalSize(),t=this.$TiledSphericalRenderer1.getTileContentSize()/this.$TiledSphericalRenderer1.getTileTotalSize(),u=Math.pow(2,p.level-q.level),v=t/u,w=p.col-u*q.col,x=p.row-u*q.row,y=s+w*v,z=s+x*v;return [y,z,y+v,z,y,z+v,y+v,z+v];};o.prototype.$TiledSphericalRenderer50=function(p){var q=void 0;if(p.level===0){q={lastUsedTime:0,texture:this.$TiledSphericalRenderer5.get(p.getKey())};}else q=this.$TiledSphericalRenderer4.get(p.getKey());if(q){this.__gl.bindTexture(this.__gl.TEXTURE_2D,q.texture);q.lastUsedTime=this.$TiledSphericalRenderer8;return p;}throw new Error('No possible tile for requested params: '+p.getKey());};o.prototype.$TiledSphericalRenderer51=function(p){var q=0;while(q<=p.level){var r=p.getInfoForOffsetLevel(q),s=r.getKey(),t=void 0;if(r.level===0){t={lastUsedTime:0,texture:this.$TiledSphericalRenderer5.get(s)};}else t=this.$TiledSphericalRenderer4.get(s);if(t){this.__gl.bindTexture(this.__gl.TEXTURE_2D,t.texture);t.lastUsedTime=this.$TiledSphericalRenderer8;return r;}else this.$TiledSphericalRenderer1.loadTileImage(r,this.$TiledSphericalRenderer43,this.$TiledSphericalRenderer8);q++;}throw new Error('No possible tile for requested params: '+p.getKey());};o.prototype.$TiledSphericalRenderer38=function(p){var q=0;while(q<=p.level){var r=p.getInfoForOffsetLevel(q),s=r.getKey();if(this.$TiledSphericalRenderer5.has(s)||this.$TiledSphericalRenderer4.has(s))return r;q++;}throw new Error('No possible tile for requested params: '+p.getKey());};o.prototype.$TiledSphericalRenderer29=function(){var p=this.$TiledSphericalRenderer1.getBaseLevelImageTiles();p.forEach(function(q){var r=this.__copyTextureToGLBuffer({image:q.getImg()},this.__gl.TEXTURE_2D),s=this.__gl.getError();if(s!==0)this.__emitRenderingError(s);this.$TiledSphericalRenderer5.set(q.getInfo().getKey(),r);}.bind(this));};o.prototype.$TiledSphericalRenderer30=function(){var p=this.$TiledSphericalRenderer1.getViewportImageTiles();p.forEach(function(q){var r=this.__copyTextureToGLBuffer({image:q.getImg()},this.__gl.TEXTURE_2D),s=this.__gl.getError();if(s!==0)this.__emitRenderingError(s);var t={texture:r,lastUsedTime:c('performanceNow')()};this.$TiledSphericalRenderer4.set(q.getInfo().getKey(),t);}.bind(this));};o.prototype.$TiledSphericalRenderer47=function(p){var q,r=this,s=p.getInfo().getKey(),t=this.$TiledSphericalRenderer4.get(s);if(!t){var u=this.__copyTextureToGLBuffer({image:p.getImg()},this.__gl.TEXTURE_2D),v=this.__gl.getError();if(v!==0)this.emit('renderingError','WebGL Error Code: '+v);t={texture:u,lastUsedTime:c('performanceNow')()};this.$TiledSphericalRenderer4.set(s,t);if(this.$TiledSphericalRenderer4.size>n)(function(){var w=s,x=t;r.$TiledSphericalRenderer4.forEach(function(y,z){if(y.lastUsedTime<x.lastUsedTime){w=z;x=y;}});r.__gl.deleteTexture(x.texture);r.$TiledSphericalRenderer4['delete'](w);})();}};o.prototype.$TiledSphericalRenderer26=function(){this.$TiledSphericalRenderer17=[];var p=k.create();k.identity(p);k.rotateY(p,p,j.toRadian(-90));this.$TiledSphericalRenderer17[m.PLUS_X]=p;var q=k.create();k.identity(q);k.rotateY(q,q,j.toRadian(90));this.$TiledSphericalRenderer17[m.MINUS_X]=q;var r=k.create();k.identity(r);k.rotateZ(r,r,j.toRadian(180));k.rotateX(r,r,j.toRadian(-90));this.$TiledSphericalRenderer17[m.PLUS_Y]=r;var s=k.create();k.identity(s);k.rotateZ(s,s,j.toRadian(180));k.rotateX(s,s,j.toRadian(90));this.$TiledSphericalRenderer17[m.MINUS_Y]=s;var t=k.create();k.identity(t);k.rotateY(t,t,j.toRadian(180));this.$TiledSphericalRenderer17[m.PLUS_Z]=t;var u=k.create();k.identity(u);this.$TiledSphericalRenderer17[m.MINUS_Z]=u;this.$TiledSphericalRenderer18=[];var v=this.$TiledSphericalRenderer3,w=[l.fromValues(-v,v,-v),l.fromValues(v,v,-v),l.fromValues(v,-v,-v),l.fromValues(-v,-v,-v)];for(var x=0;x<6;x++){var y=this.$TiledSphericalRenderer17[x],z=[];for(var aa=0;aa<w.length;aa++){var ba=l.create();l.transformMat4(ba,w[aa],y);z.push(ba);}this.$TiledSphericalRenderer18[x]=z;}};o.prototype.$TiledSphericalRenderer39=function(p){var q=p;while(!this.$TiledSphericalRenderer5.has(q.getKey())&&!this.$TiledSphericalRenderer4.has(q.getKey())){this.$TiledSphericalRenderer1.loadTileImage(q,this.$TiledSphericalRenderer43,this.$TiledSphericalRenderer8);q=q.getInfoForOffsetLevel(1);}};o.__subClassMethods={__getFragmentShaderScript:true,__getVertexShaderScript:true,__getShaderPerspectiveMatrixUniformName:true,__getShaderRotationMatrixUniformName:true,__renderInternal:true,__shaderProgramReady:true,__getMaxGPUMemoryUsedBytes:true,__getPrevFrameTextureScreenRatio:true,__createTexture:true,__clearCache:true};f.exports=o;}),null);
__d('getScaledPanoDimensions',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k={croppedAreaImageHeightPixels:Number(i.CroppedAreaImageHeightPixels)||0,croppedAreaImageWidthPixels:Number(i.CroppedAreaImageWidthPixels)||0,croppedAreaLeftPixels:Number(i.CroppedAreaLeftPixels)||0,croppedAreaTopPixels:Number(i.CroppedAreaTopPixels)||0,fullPanoHeightPixels:Number(i.FullPanoHeightPixels)||0,fullPanoWidthPixels:Number(i.FullPanoWidthPixels)||0};if(k.croppedAreaImageWidthPixels&&j!==k.croppedAreaImageWidthPixels){var l=j/k.croppedAreaImageWidthPixels;k.croppedAreaImageWidthPixels*=l;k.croppedAreaImageHeightPixels*=l;k.croppedAreaLeftPixels*=l;k.croppedAreaTopPixels*=l;k.fullPanoHeightPixels*=l;k.fullPanoWidthPixels*=l;}return k;}f.exports=h;}),null);
__d('SphericalPhotoRenderer.redux',['cx','Promise','Bootloader','CubemapImageTileProvider','DOM','EntPhotoCubemapTileUriProvider','Event','ImageUtils','PhotoProjection','SphericalMediaCanvasPool','SphericalMediaRenderer.react','StaticCubemapTileUriProvider','TiledSphericalRendererConfig','joinClasses','performanceNow','uniqueID','getScaledPanoDimensions','ReactRedux','SphericalMediaCoreActions','SphericalMediaViewActions','SphericalMediaBaseActions','SphericalPhotoActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('TiledSphericalRendererConfig').renderer,l=c('ReactRedux').connect,m=c('SphericalMediaCoreActions').turnOff,n=c('SphericalMediaViewActions').updateViewportAndFOV,o=c('SphericalMediaBaseActions').updateBase,p=c('SphericalMediaBaseActions').setupRenderer,q=c('SphericalMediaBaseActions').webGlInitFailed,r=c('SphericalMediaBaseActions').webGlRenderFailed,s=c('SphericalMediaBaseActions').webGlContextLost,t=c('SphericalMediaBaseActions').sourceOnLoad,u=c('SphericalMediaBaseActions').viewportClicked,v=c('SphericalPhotoActions').rendererStats,w=2;i=babelHelpers.inherits(x,c('SphericalMediaRenderer.react'));j=i&&i.prototype;function x(z){j.constructor.call(this,z);this.$SphericalPhotoRenderer10=function(){this.draw(this.__getViewData());}.bind(this);this.__sourceElement=c('DOM').create('img');this.$SphericalPhotoRenderer1=c('uniqueID')();this.$SphericalPhotoRenderer2=0;this.$SphericalPhotoRenderer3=null;}x.prototype.__afterDraw=function(){};x.prototype.__beforeCanvasLost=function(){this.$SphericalPhotoRenderer4();this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;if(this.props.isActive)this.props.dispatch(m());};x.prototype.__getViewData=function(){var z=this.props.viewStore.getState(),aa=z.view;return {fov:aa.fov,pitch:aa.pitch,yaw:aa.yaw};};x.prototype.__getCanvas=function(){var z=this.$SphericalPhotoRenderer5();c('SphericalMediaCanvasPool').setLimit(w,z);var aa={canvasAttrs:{width:this.props.width,height:this.props.height,className:c('joinClasses')(this.props.className,"_5nxw")},beforeCanvasLost:function(){return this.__beforeCanvasLost();}.bind(this)};return c('SphericalMediaCanvasPool').get(this.$SphericalPhotoRenderer1,aa,z);};x.prototype.__onSetupDone=function(){this.$SphericalPhotoRenderer6();};x.prototype.__isReadyToSetup=function(){return this.props.isActive&&this.props.imageLoaded;};x.prototype.__onFallbackUIClick=function(){this.props.dispatch(u());};x.prototype.__onWebGlRenderFailed=function(z,aa){this.props.dispatch(r(z,aa));};x.prototype.__onWebGlContextLost=function(){this.props.dispatch(s());this.props.dispatch(m());};x.prototype.__onWebGlInitFailed=function(z){c('SphericalMediaCanvasPool').release(this.$SphericalPhotoRenderer1,this.props.canvasNamespace);this.props.dispatch(q(z));this.props.dispatch(m());};x.prototype.__getRenderer=function(z){return new (c('Promise'))(function(aa,ba){var ca,da=this,ea=this.props,fa=ea.projectionType,ga=ea.photoSphereMetadata;if(this.props.tiledSphericalConfig.useTiledRenderer&&this.__cubemapImageTileProvider){aa(new k(z,this.__cubemapImageTileProvider,{partialLeftDegrees:this.props.partialLeftDegrees,partialRightDegrees:this.props.partialRightDegrees,partialTopDegrees:this.props.partialTopDegrees,partialBottomDegrees:this.props.partialBottomDegrees},ga.ProjectionType===c('PhotoProjection').CYLINDRICAL));}else (function(){if(!da.props.imageLoaded)throw new Error('__getRenderer was called before the source has been loaded.');var ha=c('getScaledPanoDimensions')(ga,da.__sourceElement.width);if(fa===c('PhotoProjection').EQUIRECTANGULAR){c('Bootloader').loadModules(["EquirectSphericalWebGLRenderer"],function(ia){try{aa(new ia(this.__sourceElement,z,babelHelpers['extends']({poseHeadingDegrees:Number(ga.PoseHeadingDegrees)||0,posePitchDegrees:Number(ga.PosePitchDegrees)||0,poseRollDegrees:Number(ga.PoseRollDegrees)||0},ha)));}catch(ja){ba(ja);}}.bind(da),'SphericalPhotoRenderer.redux');}else if(fa===c('PhotoProjection').CYLINDRICAL){c('Bootloader').loadModules(["CylindricalSphericalWebGLRenderer"],function(ia){try{aa(new ia(this.__sourceElement,z,ha));}catch(ja){ba(ja);}}.bind(da),'SphericalPhotoRenderer.redux');}else c('Bootloader').loadModules(["CubestripSphericalWebGLRenderer"],function(ia){try{aa(new ia(this.__sourceElement,z));}catch(ja){ba(ja);}}.bind(da),'SphericalPhotoRenderer.redux');})();}.bind(this));};x.prototype.__destroy=function(){this.$SphericalPhotoRenderer4();this.$SphericalPhotoRenderer3&&this.$SphericalPhotoRenderer3();j.__destroy.call(this);c('SphericalMediaCanvasPool').release(this.$SphericalPhotoRenderer1,this.$SphericalPhotoRenderer5());this.__sourceElement=c('DOM').create('img');this.__cubemapImageTileProvider=null;this.props.dispatch(o({loaded:false}));};x.prototype.$SphericalPhotoRenderer5=function(){var z=c('PhotoProjection').CUBESTRIP;if(this.props.tiledSphericalConfig.useTiledRenderer){z=c('PhotoProjection').TILED_CUBEMAP;}else if(this.props.photoSphereMetadata.ProjectionType)z=this.props.photoSphereMetadata.ProjectionType;return z+this.props.canvasNamespace;};x.prototype.__showLoadingThumbnail=function(){return !this.props.taggingMode;};x.prototype.$SphericalPhotoRenderer4=function(){var z=this.sphericalRenderer;if(z){var aa={avg_frame_render_time:z.getAverageFrameRenderTimeMillis(),avg_texture_to_screen_ratio2:z.getAverageTextureToScreenPixelRatio(),device_pixel_ratio:window.devicePixelRatio||1,dt:z.getTimeSinceFirstRenderMillis(),max_gpu_memory_used:z.getMaxGPUMemoryUsedBytes(),max_tile_level:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getMaxTileLevel():null,render_method:this.props.tiledSphericalConfig.useTiledRenderer?'tiled':'cubestrip',total_data_loaded:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getTotalPixelsLoaded():this.$SphericalPhotoRenderer7(),viewport_height:this.props.height,viewport_width:this.props.width};this.props.dispatch(v(aa));}};x.prototype.$SphericalPhotoRenderer7=function(){if(this.__sourceElement&&c('ImageUtils').hasLoaded(this.__sourceElement)){var z=this.__sourceElement,aa=z.width,ba=z.height;return aa*ba;}return 0;};x.prototype.$SphericalPhotoRenderer8=function(z){var aa,ba=this,ca=this.props.dispatch;c('DOM').setAttributes(this.__sourceElement,{crossOrigin:'anonymous',src:z});if(c('ImageUtils').hasLoaded(this.__sourceElement)){ca(t());}else (function(){var da=c('Event').listen(ba.__sourceElement,'load',function(){ca(t());da.remove();});})();};x.prototype.$SphericalPhotoRenderer9=function(){var z=this.props,aa=z.dispatch,ba=z.tiledSphericalConfig;if(ba.useTiledRenderer&&!this.__cubemapImageTileProvider){var ca=this.props.fbid==='0'?new (c('StaticCubemapTileUriProvider'))(this.props.tiledSphericalConfig.initialTileUris):new (c('EntPhotoCubemapTileUriProvider'))(this.props.fbid,this.props.tiledSphericalConfig.initialTileUris),da=new (c('CubemapImageTileProvider'))(ca,this.props.tiledSphericalConfig.maxTileLevel,this.props.tiledSphericalConfig.viewportTileUris);da.addBaseLevelReadyCallback(function(){return aa(t());});this.__cubemapImageTileProvider=da;}};x.prototype.$SphericalPhotoRenderer6=function(){this.$SphericalPhotoRenderer3=this.props.viewStore.subscribe(this.$SphericalPhotoRenderer10);this.draw(this.__getViewData());var z=this.sphericalRenderer;if(z){var aa=c('performanceNow')()-this.$SphericalPhotoRenderer2;this.props.dispatch(p(z,aa));}};x.prototype.componentDidMount=function(){var z=this.props.tiledSphericalConfig.useTiledRenderer;if(z){this.$SphericalPhotoRenderer9();}else if(this.props.cubeStripImageURI)this.$SphericalPhotoRenderer8(this.props.cubeStripImageURI);if(this.props.isActive)this.$SphericalPhotoRenderer2=c('performanceNow')();j.componentDidMount.call(this);};x.prototype.componentWillReceiveProps=function(z){this.shouldRender=z.isActive&&!this.props.renderer||z.isActive!==this.props.isActive||z.thumbnail!==this.props.thumbnail||z.showFallbackUI!==this.props.showFallbackUI||z.width!==this.props.width||z.height!==this.props.height;if(z.isActive&&z.isActive!==this.props.isActive)this.$SphericalPhotoRenderer2=c('performanceNow')();if(this.props.renderer&&z.projectionType!==this.props.projectionType)this.__destroy();var aa=this.props.tiledSphericalConfig.useTiledRenderer;if(aa){this.$SphericalPhotoRenderer9();}else if(z.cubeStripImageURI&&!this.__sourceElement.src)this.$SphericalPhotoRenderer8(z.cubeStripImageURI);j.componentWillReceiveProps.call(this,z);};x.prototype.componentWillUnmount=function(){this.props.viewStore.dispatch(n(this.props.initialYaw,this.props.initialPitch,this.props.initialFov));j.componentWillUnmount.call(this);};x.__subClassMethods={__afterDraw:true,__beforeCanvasLost:true,__getCanvas:true,__getRenderer:true,__getViewData:true,__onSetupDone:true,__isReadyToSetup:true,__onFallbackUIClick:true,__showLoadingThumbnail:true,__onWebGlContextLost:true,__onWebGlInitFailed:true,__onWebGlRenderFailed:true};var y=function z(aa){return {className:aa.base.className,expansionCoef:aa.base.expansionCoef,fallback:aa.base.fallback,height:aa.base.height,initialFov:aa.base.initialFov,initialPitch:aa.base.initialPitch,initialYaw:aa.base.initialYaw,isActive:aa.base.isRendererActive,projectionType:aa.base.projectionType,renderer:aa.base.renderer,tiledSphericalConfig:aa.base.tiledSphericalConfig,width:aa.base.width,partialLeftDegrees:aa.base.partialLeftDegrees,partialRightDegrees:aa.base.partialRightDegrees,partialTopDegrees:aa.base.partialTopDegrees,partialBottomDegrees:aa.base.partialBottomDegrees,fbid:aa.base.fbid,isFetchingData:aa.base.isFetchingData,imageLoaded:aa.base.loaded,cubeStripImageURI:aa.base.src,showFallbackUI:aa.base.showFallbackUI,taggingMode:aa.base.taggingMode,thumbnail:aa.base.thumbnail,canvasNamespace:aa.base.canvasNamespace,src:aa.base.src,photoSphereMetadata:aa.base.photoSphereMetadata,viewStore:aa.base.viewStore};};f.exports=l(y)(x);}),null);
__d('SphericalPhotoStore',['SphericalMediaBaseStore','SphericalMediaBaseReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('SphericalMediaBaseStore'));i=h&&h.prototype;j.prototype.getReducers=function(){return {base:c('SphericalMediaBaseReducer')};};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d("SphericalPhotoFeedEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DRAG_START:0,VIEWPORT_CLICKED:1,TAP_HEADING_INDICATOR:2});}),null);
__d('SphericalPhotoViewerLoggingMiddleware',['Banzai','Bootloader','immutable','SphericalMediaActions','SphericalPhotoConfig','collectDataAttributes','SphericalPhotoConstants','SphericalPhotoFeedEvents'],(function a(b,c,d,e,f,g){'use strict';var h=c('SphericalPhotoConstants').FEED_TRACKING_KEY,i={NEWSSTAND:'newsstand'},j={CONTENT_CLICK:175},k=c('immutable').List(),l=function n(o,p,q){var r,s=c('collectDataAttributes')(o,['ft']),t={ft:babelHelpers['extends']((r={},r[h]=p,r),s.ft?s.ft:{})};if(q)t.ft.evt=q;c('Banzai').post('feed_tracking',t,{});},m=function n(o){var p=o.getState,q=void 0,r=void 0;if(c('SphericalPhotoConfig').www_can_viewer_tag){c('Bootloader').loadModules(["SphericalPhotoViewerLoggingUtil","SphericalPhotoTagLoggingUtil"],function(s,t){q=s;r=t;k.forEach(function(u){q&&q.log(u.action,u.base);r&&r.log(u.action,u.base);});k=k.clear();},'SphericalPhotoViewerLoggingMiddleware');}else c('Bootloader').loadModules(["SphericalPhotoViewerLoggingUtil"],function(s){q=s;k.forEach(function(t){q&&q.log(t.action,t.base);});k=k.clear();},'SphericalPhotoViewerLoggingMiddleware');return function(s){return function(t){var u=p();if(q){q.log(t,u.base);r&&r.log(t,u.base);}else k=k.push({action:t,base:u.base});if(u.base.surface===i.NEWSSTAND&&u.base.ctrElement)switch(t.type){case c('SphericalMediaActions').VIEWPORT_CLICKED:l(u.base.ctrElement,c('SphericalPhotoFeedEvents').VIEWPORT_CLICKED);break;case c('SphericalMediaActions').TAP_HEADING_INDICATOR:l(u.base.ctrElement,c('SphericalPhotoFeedEvents').TAP_HEADING_INDICATOR);break;case c('SphericalMediaActions').DRAG_START:l(u.base.ctrElement,c('SphericalPhotoFeedEvents').DRAG_START,j.CONTENT_CLICK);break;}return s(t);};};};f.exports=m;}),null);
__d('SphericalPhotoViewer.react',['cx','BootloadedComponent.react','JSResource','React','SphericalPhotoController.redux','SphericalPhotoFallbackMiddleware','SphericalPhotoViewerLoggingMiddleware','SphericalPhotoRenderer.redux','SphericalPhotoConfig','SphericalPhotoStore','ReactRedux','SphericalMediaCoreActions','SphericalMediaBaseActions','SphericalMediaViewActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('ReactRedux').Provider,l=c('SphericalMediaCoreActions').turnOn,m=c('SphericalMediaCoreActions').turnOff,n=c('SphericalMediaBaseActions').updateBase,o=c('SphericalMediaBaseActions').updateDimension,p=c('SphericalMediaViewActions').updateView;i=babelHelpers.inherits(q,c('React').PureComponent);j=i&&i.prototype;function q(r){j.constructor.call(this,r);this.__store=new (c('SphericalPhotoStore'))(this.__getMiddleware()).getStore();}q.prototype.componentWillUnmount=function(){this.__store.dispatch(m());};q.prototype.componentWillMount=function(){this.__updateState();this.__store.dispatch(l());};q.prototype.componentDidUpdate=function(){this.__updateState();};q.prototype.__getMiddleware=function(){var r=this.props.middlewares||[];return r.concat([c('SphericalPhotoViewerLoggingMiddleware'),c('SphericalPhotoFallbackMiddleware')]);};q.prototype.__updateState=function(){var r={enableGyro:this.props.enableGyro,enableZoom:this.props.enableZoom,enableRubberBanding:this.props.enableRubberBanding,visibility:true};if(this.props.partialLimits)r=babelHelpers['extends']({},r,this.props.partialLimits);this.__store.dispatch(n(babelHelpers['extends']({enableTagging:c('SphericalPhotoConfig').www_can_viewer_tag&&this.props.enableTagging,initialYaw:this.props.initialView.yaw,initialPitch:this.props.initialView.pitch,initialFov:this.props.initialView.fov,tiledSphericalConfig:this.props.tiledSphericalConfig,caption:this.props.caption,canvasNamespace:this.props.canvasNamespace,fallback:this.props.fallback,fallbackCTAElement:this.props.fallbackCTAElement,fbid:this.props.photoID,photoSphereMetadata:this.props.photoSphereMetadata||{},src:this.props.cubeImageURI,surface:this.props.surface,thumbnail:this.props.initialImageURI||''},r)));this.__store.dispatch(o(this.props.width,this.props.height));var s=this.__store.getState().base.viewStore;s.dispatch(p({yaw:this.props.initialView.yaw,pitch:this.props.initialView.pitch,fov:this.props.initialView.fov}));};q.prototype.render=function(){return c('React').createElement(k,{store:this.__store},c('React').createElement('div',{className:"_3o6m _5nxw"},c('React').createElement(c('SphericalPhotoRenderer.redux'),null),this.__store.getState().base.enableTagging?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalPhotoTagging.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null,c('React').createElement(c('SphericalPhotoController.redux'),null),c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalPhotoHeadingIndicator.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}),this.props.showMouseAnimation?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalMediaMouseOverlay.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null,this.props.showGyroAnimation?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalMediaGyroOverlay.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null));};q.defaultProps={canvasNamespace:'PhotoViewer',enableGyro:false,enableRubberBanding:false,enablevisibilityObserver:false,enableZoom:false,showGyroAnimation:false,showMouseAnimation:true};f.exports=q;}),null);
__d('SphericalPhotoViewerInFeed.react',['cx','Arbiter','Bootloader','CSS','Event','ReactDOM','SphericalMediaActions','SphericalPhotoConfig','SphericalPhotoViewer.react','Style','SubscriptionsHandler','getElementRect','onViewportChanged','debounce','SphericalMediaCoreActions','SphericalMediaBaseActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('SphericalMediaCoreActions').turnOn,l=c('SphericalMediaCoreActions').turnOff,m=c('SphericalMediaBaseActions').visibilityChanged,n=c('SphericalMediaBaseActions').updateDimension,o=5000,p=50;i=babelHelpers.inherits(q,c('SphericalPhotoViewer.react'));j=i&&i.prototype;function q(){var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=j.constructor).call.apply(r,[this].concat(u)),this.$SphericalPhotoViewerInFeed6=false,this.$SphericalPhotoViewerInFeed14=function(){if(this.$SphericalPhotoViewerInFeed15())return;if(this.$SphericalPhotoViewerInFeed8&&this.$SphericalPhotoViewerInFeed8.isOpen)return;this.__store.dispatch(k());}.bind(this),this.$SphericalPhotoViewerInFeed13=c('debounce')(function(w){if(!this.$SphericalPhotoViewerInFeed5)return;var x=c('getElementRect')(this.$SphericalPhotoViewerInFeed5),y=w.bottom-w.top,z=x.bottom-x.top,aa=(y-z)/3,ba=w.top+aa,ca=w.bottom-aa,da=x.top>ba&&x.top<ca||x.bottom>ba&&x.bottom<ca||ba>x.top&&ca<x.bottom;if(this.$SphericalPhotoViewerInFeed3!==da){this.$SphericalPhotoViewerInFeed3=da;da?this.$SphericalPhotoViewerInFeed16():this.$SphericalPhotoViewerInFeed17();}}.bind(this),p),s;}q.prototype.__getMiddleware=function(){var r=j.__getMiddleware.call(this),s=function(){return function(w){return function(x){if(x.type===c('SphericalMediaActions').VIEWPORT_CLICKED)c('Bootloader').loadModules(["PhotoSnowlift"],function(y){y.bootstrap(this.props.permalinkURI);this.$SphericalPhotoViewerInFeed8=y.getInstance();}.bind(this),'SphericalPhotoViewerInFeed.react');return w(x);}.bind(this);}.bind(this);}.bind(this),t=function(w){var x=w.getState;return function(y){return function(z){var aa=x().base.showFallbackUI;if(!aa){if(z.type===c('SphericalMediaActions').TURN_ON)this.$SphericalPhotoViewerInFeed9();if(z.type===c('SphericalMediaActions').SETUP_RENDERER)this.$SphericalPhotoViewerInFeed10();}return y(z);}.bind(this);}.bind(this);}.bind(this),u=function(w){var x=w.dispatch;return function(y){return function(z){if(c('SphericalPhotoConfig').show_fallback_ui&&z.type===c('SphericalMediaActions').SHOW_FALLBACK&&this.props.fallback){if(c('SphericalPhotoConfig').show_fallback_ui_simple&&this.props.fallbackCTAElement){c('CSS').show(this.props.fallbackCTAElement);}else{var aa=this.props.width,ba=this.props.width/this.props.fallback.aspectRatio;x(n(aa,ba));if(this.props.viewerElement)c('Style').apply(this.props.viewerElement,{height:ba+'px',width:aa+'px'});if(this.props.initialViewElement)c('CSS').hide(this.props.initialViewElement);c('CSS').hide(this.props.loadingElement);this.$SphericalPhotoViewerInFeed10();}this.$SphericalPhotoViewerInFeed11();}return y(z);}.bind(this);}.bind(this);}.bind(this),v=function(w){var x=w.getState;return function(y){return function(z){var aa=x().base.showFallbackUI;if(!aa)if(z.type===c('SphericalMediaActions').TURN_OFF){this.$SphericalPhotoViewerInFeed3=false;c('CSS').show(this.props.loadingElement);this.$SphericalPhotoViewerInFeed12();}return y(z);}.bind(this);}.bind(this);}.bind(this);return r.concat([s,t,v,u]);};q.prototype.componentDidMount=function(){this.__updateState();this.$SphericalPhotoViewerInFeed12();var r=c('onViewportChanged')(this.$SphericalPhotoViewerInFeed13);this.$SphericalPhotoViewerInFeed1=c('Arbiter').subscribe('PhotoSnowlift.CLOSE',function(){this.$SphericalPhotoViewerInFeed3=false;r.scheduleCheck();}.bind(this));this.$SphericalPhotoViewerInFeed2=c('Arbiter').subscribe('PhotoSnowlift.OPEN',function(){c('Bootloader').loadModules(["PhotoSnowlift"],function(u){this.$SphericalPhotoViewerInFeed8=u.getInstance();}.bind(this),'SphericalPhotoViewerInFeed.react');}.bind(this));this.$SphericalPhotoViewerInFeed3=false;var s=new (c('SubscriptionsHandler'))(),t=c('ReactDOM').findDOMNode(this);s.addSubscriptions(c('Event').listen(t,'mouseenter',this.$SphericalPhotoViewerInFeed14),c('Event').listen(t,'touchstart',this.$SphericalPhotoViewerInFeed14));r.scheduleCheck();this.$SphericalPhotoViewerInFeed4=r;this.$SphericalPhotoViewerInFeed7=s;this.$SphericalPhotoViewerInFeed5=t;};q.prototype.componentWillMount=function(){this.__updateState();};q.prototype.componentWillUnmount=function(){this.$SphericalPhotoViewerInFeed11();this.$SphericalPhotoViewerInFeed5=null;j.componentWillUnmount.call(this);};q.prototype.$SphericalPhotoViewerInFeed11=function(){if(this.$SphericalPhotoViewerInFeed1){c('Arbiter').unsubscribe(this.$SphericalPhotoViewerInFeed1);this.$SphericalPhotoViewerInFeed1=null;}if(this.$SphericalPhotoViewerInFeed2){c('Arbiter').unsubscribe(this.$SphericalPhotoViewerInFeed2);this.$SphericalPhotoViewerInFeed2=null;}this.$SphericalPhotoViewerInFeed4&&this.$SphericalPhotoViewerInFeed4.remove();this.$SphericalPhotoViewerInFeed4=null;this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.release();this.$SphericalPhotoViewerInFeed7=null;};q.prototype.$SphericalPhotoViewerInFeed9=function(){c('CSS').addClass(this.props.loadingElement,"_2dz7");c('CSS').removeClass(this.props.loadingElement,"_3s0i");};q.prototype.$SphericalPhotoViewerInFeed12=function(){c('CSS').removeClass(this.props.loadingElement,"_2dz7");c('CSS').addClass(this.props.loadingElement,"_3s0i");};q.prototype.$SphericalPhotoViewerInFeed10=function(){c('CSS').removeClass(this.props.loadingElement,"_2dz7");setTimeout(function(){return c('CSS').hide(this.props.loadingElement);}.bind(this),300);};q.prototype.$SphericalPhotoViewerInFeed15=function(){return this.__store.getState().base.isRendererActive;};q.prototype.$SphericalPhotoViewerInFeed17=function(){this.$SphericalPhotoViewerInFeed12();setTimeout(function(){if(!this.$SphericalPhotoViewerInFeed3&&this.$SphericalPhotoViewerInFeed15())this.__store.dispatch(l());}.bind(this),o);this.__store.dispatch(m(false));};q.prototype.$SphericalPhotoViewerInFeed16=function(){this.$SphericalPhotoViewerInFeed14();this.__store.dispatch(m(true));};f.exports=q;}),null);